var R={};var R_loc={"download":"Download","preparing_for_upload":"Preparing for upload","error":"Error","complete":"complete","cannot_receive_information_from_server":"Cannot receive information from server. Please try again later.","can_not_upload_file_to_the_server":"Can't upload file to the server","login_to_your_account":"Login to Your Account","the_username_can_only_consist_of_alphabetical_number_dot_and_underscore":"The username can only consist of alphabetical, number, dot and underscore","help_i":"Help, I","select_image":"Select image","file_uploading":"File uploading","label_close":"Close"};var g_popped=false;var g_login_token=""; // Login token used for authentication
var load_translations=function(anon,callback){var url="/api/lang/get_langs"+(anon?"_anon":"");do_authenticated_http_call({method:"GET",url:url,success:function(data){var old_R=R;R=data;if(document.title){if(document.title.indexOf("Xenforma")!=-1){document.title=document.title.replace("Xenforma",R.client_application_title||"Xenforma");}if(old_R.client_application_title&&document.title.indexOf(old_R.client_application_title)!=-1){document.title=document.title.replace("Xenforma",R.client_application_title||"Xenforma");}}else {document.title=R.client_application_title||"Xenforma";}if(callback&&typeof callback=="function"){callback();}}});};var is_logged_in=function(callback){if(g_login_token==null||g_login_token==undefined||g_login_token==""){g_login_token=localStorage.getItem("login_token");}if(g_login_token==null||g_login_token==undefined||g_login_token==""){return callback(false);}do_authenticated_http_call({method:"GET",url:"/api/auth/is_logged_in",success:function(response){if(response.logged_in){return callback(true,response);}return callback(false,response);},error:function(error){return callback(false,error);}});};var do_authenticated_http_call=function(options){if(options===undefined){options={};}if(options.headers===undefined){options.headers={};}if(g_login_token==null||g_login_token==undefined||g_login_token==""){g_login_token=localStorage.getItem("login_token");}if(g_login_token){options.headers["Authorization"]="JWT "+g_login_token;}return $.ajax(options);};var push_href_location=function(title,url){if(!g_popped){window.history.pushState({html:document.innerHTML,pageTitle:title},"",url);}document.title=title;g_popped=false;};var get_attribute_for_field=function(entity_attributes,field){for(var i=0;i<entity_attributes.attributes.length;i++){var entity_attribute=entity_attributes.attributes[i];if(entity_attribute.field_path==field){return entity_attribute;}}};function makeid(){var text="";var possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<7;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text;}function find_index_by_id(array,_id){if(_id&&array&&array.length>0){var index;for(var i=0;i<array.length;i++){if(array[i]._id&&array[i]._id==_id){index=i;break;}}return index;}}function display_yes_no_dialogue(title,message,callback){DevExpress.ui.dialog.confirm(message,title).done(function(result){if(result){return callback(true);}else {return callback(false);}});}var current_navigation_listener;var idle_time=0;var idle_interval;var get_clear_state=function(){var state_object={};state_object.settings=false;state_object.invite_users=false;state_object.edit_form=false;state_object.data_list=false;state_object.app_object_code=false;state_object.edit_form_id=undefined;state_object.dashboard=false;state_object.setup_user=false;state_object.reset_password=false;state_object.forgot_password=false;state_object.search=false;state_object.search_string=undefined;state_object.user_data_list=false;state_object.home=false;return state_object;};function get_parameter_by_name(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "));}$(document).ready(function(){var MainElement=React.createElement(MainComponent,null);ReactDOM.render(MainElement,document.getElementById("main-container"));});window.onerror=function(message,url,line_number){var error={};error.message=message;error.url=url;error.line_number=line_number;log_error(error);return false;};'use strict';function invoke_method(entity,method,data,success,error,complete){var request={};request.entity=entity;request.method=method;request.data=data;do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",contentType:"application/json",dataType:'json',data:JSON.stringify(request),success:success,error:function(err){if(err.responseJSON&&error&&typeof error==="function"){error(err.responseJSON);}console.log(err);},complete:complete});}function log_error(error){var request={};request.entity="error";request.method="log_error";request.data={error:error};do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",contentType:"application/json",dataType:'json',data:JSON.stringify(request)});}function get_app_object(app_object_code,extra,success,error,complete){if(!extra){extra={};}extra.app_object_code=app_object_code;invoke_method("app_object","get_by_code",extra,function(data){success(data.data);},error,complete);}function make_friendly_caption(caption_fields,entity_values){var ret_val="";for(var i=0;i<caption_fields.length;i++){var complex_path=caption_fields[i];var field_value=entity_values[complex_path];if(field_value){ret_val=ret_val?ret_val+" "+field_value:field_value;}}return ret_val;}function make_conditions_from_devextreme_filter(filter_arr){ //format1: [3]
//[3] == att.field_path, "contains", filter_box.value
//alternates for "contains":  "=", "<>", ">", ">=", "<", "<=", "startswith", "endswith", "contains", "notcontains"
//format2: [[3], "and", [3], "or", [3], ...]
var ret_val;ret_val=filter_arr[0];if(typeof ret_val=="string"){ret_val=parse_condition_obj(filter_arr);}else if(typeof ret_val=="function"){ret_val=parse_condition_obj(filter_arr);}else if(Object.prototype.toString.call(ret_val)==='[object Array]'||Object.prototype.toString.call(ret_val)==='[object Object]'){ //an array of conditions joined by and/or
ret_val=parse_condition_obj(ret_val);for(var i=1;i<filter_arr.length;i++){var condition=filter_arr[i];if(condition){if(Object.prototype.toString.call(condition)==='[object Array]'){ //implies AND
condition=parse_condition_obj(condition);ret_val=add_and_condition(ret_val,condition);}else if(typeof condition=="string"){if(condition=="and"){i++;condition=parse_condition_obj(filter_arr[i]);ret_val=add_and_condition(ret_val,condition);}else if(condition=="or"){i++;condition=parse_condition_obj(filter_arr[i]);ret_val=add_or_condition(ret_val,condition);}}}}}return ret_val;}function make_sorting_conditions_from_devextreme_sort(sort_arr){var ret_val={};for(var i=0;i<sort_arr.length;i++){ //usually only 1
var field_path=sort_arr[i].selector;var descending=sort_arr[i].desc;ret_val[field_path]=descending?-1:1;}return ret_val;}var filter_conditions_mongo_equivalent_lookup={"=":"$eq","<>":"$ne",">":"$gt",">=":"$gte","<":"$lt","<=":"$lte" //,
//"contains": "$in",
//"notcontains": "$nin",
//"startswith": "",
//"endswith": ""
};function try_parse_regexp(value){if(value&&typeof value=="string"){var m=value.match(/\/(.*)\/(.*)?/);return new RegExp(m[1],m[2]||"");}return value;}function parse_condition_obj(condition_obj){ //[3] == att.field_path, "contains", filter_box.value
//alternates for "contains":  "=", "<>", ">", ">=", "<", "<=", "startswith", "endswith", "contains", "notcontains"
if(!condition_obj||typeof condition_obj!="object"||!Array.isArray(condition_obj)||condition_obj.length!==3){return null;}var field_path=condition_obj[0];if(typeof field_path=="function"){field_path=field_path();}var operator=condition_obj[1];var comparison_value=condition_obj[2];var sub_doc={};switch(operator){ /*case "=":
        {
            sub_doc[filter_conditions_mongo_equivalent_lookup[operator]] = comparison_value;
            break;
        }
        case "<>":
        {

            break;
        }
        case ">":
        {

            break;
        }
        case ">=":
        {

            break;
        }
        case "<":
        {

            break;
        }
        case "<=":
        {

            break;
        }*/case "startswith":{sub_doc["$regex"]="^"+comparison_value.replace(/ /g,'\\s');sub_doc["$options"]="i";break;}case "endswith":{sub_doc["$regex"]=comparison_value.replace(/ /g,'\\s')+"$";sub_doc["$options"]="i";break;}case "contains":{sub_doc["$regex"]=comparison_value.replace(/ /g,'\\s');sub_doc["$options"]="i";break;}case "notcontains":{sub_doc["$regex"]=comparison_value.replace(/ /g,'\\s');sub_doc["$options"]="i";sub_doc={"$not":sub_doc};break;}default:{sub_doc[filter_conditions_mongo_equivalent_lookup[operator]]=comparison_value;break;}}var ret_val={};ret_val[field_path]=sub_doc;return ret_val;}function add_and_condition(ret_val,condition){if(!condition){return;}if(!ret_val["$and"]){var old_ret=ret_val;ret_val={};ret_val["$and"]=[old_ret];}ret_val["$and"].push(condition);return ret_val;}function add_or_condition(ret_val,condition){if(!condition){return;}if(!ret_val["$or"]){var old_ret=ret_val;ret_val={};ret_val["$or"]=[old_ret];}ret_val["$or"].push(condition);return ret_val;}var DashboardComponent=React.createClass({displayName:"DashboardComponent",components:{},getInitialState:function(){this.initialize_dashboard();return {};},componentDidUpdate:function(){if(Object.keys(this.components).length==0){return;}var context=this;var options={animate:true,float:true,width:12,cell_height:80,vertical_margin:10};var gridstack=$("#dashboard-dashboards").gridstack(options).data('gridstack');for(var key in this.components){var component=this.components[key];gridstack.add_widget('<div class="widget no-header dashboard-part"><div class="grid-stack-item-content widget-body"><div id="'+component.div_id+'"></div></div></div>',0,0,component.dashboard_part.width,component.dashboard_part.row_number,true);var type=component.dashboard_part.visualization_type;switch(type){case "pie_chart":var properties={};properties.dataSource=component.dashboard_part.aggregation_data;properties.title=component.dashboard_part.caption;properties.legend={visible:false};properties.animation={enabled:true};properties.resolveLabelOverlapping="shift";properties.series=[{argumentField:component.dashboard_part.custom_properties.argumentField,valueField:component.dashboard_part.custom_properties.valueField,label:{visible:true,customizeText:function(arg){return arg.argumentText+" ("+arg.valueText+")";}}}];if(component.dashboard_part.linked_app_object_code){var context=this;properties.onPointClick=function(event){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);};}$("#"+component.div_id).dxPieChart(properties);break;case "line_chart":var properties={};properties.dataSource=component.dashboard_part.aggregation_data;properties.title=component.dashboard_part.caption;properties.legend={verticalAlignment:"bottom",horizontalAlignment:"center",itemTextPosition:"bottom"};properties.animation={enabled:true};properties.resolveLabelOverlapping="shift";properties.commonSeriesSettings={argumentField:component.dashboard_part.custom_properties.argumentField,type:"line"};properties.series=[{valueField:component.dashboard_part.custom_properties.valueField,name:component.dashboard_part.custom_properties.name_caption}];if(component.dashboard_part.linked_app_object_code){var context=this;properties.onPointClick=function(event){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);};}$("#"+component.div_id).dxChart(properties);break;case "bar_chart":var properties={};properties.dataSource=component.dashboard_part.aggregation_data;properties.title=component.dashboard_part.caption;properties.animation={enabled:true};properties.series=[{argumentField:component.dashboard_part.custom_properties.argumentField,valueField:component.dashboard_part.custom_properties.valueField,name:component.dashboard_part.custom_properties.name_caption,type:"bar",color:component.dashboard_part.custom_properties.color}];if(component.dashboard_part.linked_app_object_code){var context=this;properties.onPointClick=function(event){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);};}$("#"+component.div_id).dxChart(properties);break;case "ranked_list":var value_field=component.dashboard_part.custom_properties.valueField;var argument_field=component.dashboard_part.custom_properties.argumentField;var ol='<ol class="dashboard-ranked-list-ol">';for(var i=0;i<aggregation_data.length;i++){var data_point=aggregation_data[i][value_field];var argument_name=aggregation_data[i][argument_field];ol+='<li>'+data_point+' - '+argument_name+'</li>';}ol+='</ol>';var tile_html="<div>";tile_html+="<span class='dashboard-part-tile-title' title='"+component.dashboard_part.custom_properties.name_caption+"'>"+component.dashboard_part.custom_properties.name_caption+"</span>";tile_html+="<div class='bg-white no-padding'>";tile_html+=ol;tile_html+="</div></div>";jquery_element.html(tile_html);if(component.dashboard_part.linked_app_object_code){$("#"+component.div_id+" .dashboard-part-tile-body").click(function(e){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);});}break;case "tile":var value_field=component.dashboard_part.custom_properties.valueField;var data_point=aggregation_data[0][value_field];var argument_field=component.dashboard_part.custom_properties.argumentField;var argument_name=aggregation_data[0][argument_field];var data_point_color;if(component.dashboard_part.custom_properties&&component.dashboard_part.custom_properties.data_point_color){data_point_color=component.dashboard_part.custom_properties.data_point_color;}else {data_point_color="black";}var fontSize=4;if(data_point.toString().length<=6){fontSize=12-data_point.toString().length;}else if(data_point.toString().length<=8){fontSize=6;}else if(data_point.toString().length<=10){fontSize=5;}var tile_html="<div class=''>";tile_html+="<div>";tile_html+="<span class='dashboard-part-tile-title' title='"+argument_name+"'>"+argument_name+"</span>";tile_html+="<div class='bg-white no-padding'>";tile_html+="<h1 style='color:"+data_point_color+";font-size: "+fontSize+"vw' class='dashboard-part-tile-body'>"+data_point+"</h1>";tile_html+="</div></div></div>";jquery_element.html(tile_html);if(component.dashboard_part.linked_app_object_code){$("#"+component.div_id+" .dashboard-part-tile-body").click(function(e){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);});}break;default:break;}}},initialize_dashboard:function(){var context=this;var success=function(data){context.setState({app_object:data.app_object});console.log(data.app_object);push_href_location(data.app_object.name+" - "+(R.client_application_title||"Xenforma"),"/dashboard?code="+data.app_object.code);};var error=function(err){context.setState({error:err.message});};get_app_object(this.props.app_object_code,{},success,error);},render:function(){this.components={};for(var i=0;this.state.app_object&&i<this.state.app_object.dashboard_parts.length;i++){var dashboard_part=this.state.app_object.dashboard_parts[i];var div_id=makeid();this.components[div_id]={};this.components[div_id].div_id=div_id;this.components[div_id].dashboard_part=dashboard_part;}var error_component="";if(this.state.error){error_component=React.createElement("div",null,React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:this.on_error_close}),React.createElement("br",null));}return React.createElement("div",{className:"form-group"},error_component,React.createElement("div",{id:"dashboard-dashboards",className:"grid-stack"}));}});var DataListComponent=React.createClass({displayName:"DataListComponent",getInitialState:function(){var state=this.initialize_data_list();if(!state){ //placeholder while waiting for response.
state={};}state.grid_id=makeid();state.scrollViewContentElementId=makeid();return state;},initialize_data_list:function(){if(this.props.skip_init){var state_object={};state_object.app_object=this.props.app_object;state_object.entity_attributes=this.props.entity_attributes;state_object.entity_instances=this.props.entity_instances;return state_object;}var request={};request.entity="app_object";request.method="get_by_code";request.data={app_object_code:this.props.app_object_code,conditions:this.props.conditions};var context=this;console.log(JSON.stringify(request));do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",contentType:"application/json",dataType:'json',data:JSON.stringify(request),success:function(data){console.log(data.data);context.setState({app_object:data.data.app_object,entity_attributes:data.data.entity_attributes,entity_instances:[]});push_href_location(data.data.app_object.name+" - "+(R.client_application_title||"Xenforma"),"/data_list?code="+data.data.app_object.code);},error:function(error){if(error.responseJSON){console.log(error.responseJSON);context.setState({error:error.responseJSON.message});}}});},handle_close:function(event){if(event&&event.preventDefault){event.preventDefault();}var context=this;current_navigation_listener=undefined;context.props.navigation_handler("home");},updateDimensions:function(){$("#"+this.state.grid_id).dxDataGrid("instance").repaint();},componentDidMount:function(){window.addEventListener("resize",this.updateDimensions);if(this.state.app_object){this.init_grid();}$(this.popupContentElement).dxScrollView({useNative:true,scrollByThumb:true}).dxScrollView("instance");this.popup=$(this.popupElement).dxPopup({showTitle:true}).dxPopup("instance");},componentWillUnmount:function(){$(this.popupElement).remove();window.removeEventListener("resize",this.updateDimensions);},componentDidUpdate:function(){if(this.state.app_object&&!this.props.skip_init){this.init_grid();}},init_grid:function(){var grid_properties={};var context=this; //grid_properties.dataSource = this.state.entity_instances;
var send_data={conditions:{},last_id:undefined};var error_func=function(error){if(error.responseJSON){console.log(error.responseJSON);context.setState({error:error.responseJSON.message});}};var data_source;if(this.props.skip_init){data_source=this.state.entity_instances;}else {data_source=new DevExpress.data.DataSource({load:function(load_options){var d=new $.Deferred();var success_func=function(data){console.log(data);if(!load_options.sort){var grid_length=data.entity_instances.length;if(grid_length>0&&data.entity_instances[grid_length-1]._id){send_data.last_id=data.entity_instances[grid_length-1]._id;}}d.resolve(data.entity_instances);};if(!load_options.skip){ //null or 0 --happens when filter is changed.
send_data.last_id=undefined;send_data.skip=undefined;var conditions=context.props.conditions||{};if(load_options.filter&&Array.isArray(load_options.filter)){send_data.conditions=make_conditions_from_devextreme_filter(load_options.filter)||{};for(var field_path in conditions){ //these filters override custom filters
send_data.conditions[field_path]=conditions[field_path];}}else {send_data.conditions=conditions;}if(load_options.sort&&Array.isArray(load_options.sort)){send_data.sort=make_sorting_conditions_from_devextreme_sort(load_options.sort);}else {send_data.sort=undefined;}}else {if(load_options.sort&&Array.isArray(load_options.sort)){send_data.skip=load_options.skip;send_data.last_id=undefined; //not used in sorted paging
}}context.state.export_grid_conditions=send_data.conditions;invoke_method(context.state.entity_attributes.entity,"find_paged",send_data,success_func,error_func);return d.promise();},remove:function(key){$("#"+context.state.grid_id).dxDataGrid("instance").refresh();},insert:function(values){$("#"+context.state.grid_id).dxDataGrid("instance").refresh();},update:function(key,values){$("#"+context.state.grid_id).dxDataGrid("instance").refresh();}});grid_properties.paging={pageSize:this.state.app_object.page_size||10}; //infinite scroll requires pageSize.
}var custom_properties=this.state.app_object.custom_properties?this.state.app_object.custom_properties:{};var multiSelect=custom_properties.grid_multi_select==undefined?false:custom_properties.grid_multi_select;grid_properties.dataSource=data_source;if(!this.props.skip_init){grid_properties.height=function(e){return $(window).height()-180;};}grid_properties.loadPanel=true;grid_properties.columnAutoWidth=true;grid_properties.allowColumnResizing=true;grid_properties.allowColumnReordering=true;grid_properties.showRowLines=true;grid_properties.wordWrapEnabled=true;grid_properties.rowAlternationEnabled=true;grid_properties.headerFilter={visible:true};grid_properties.searchPanel={visible:!this.props.skip_init};grid_properties.filterRow={visible:!this.props.skip_init};grid_properties.export={enabled:!this.props.skip_init,fileName:this.state.app_object.name,allowExportSelectedData:multiSelect};grid_properties.stateSorting={enabled:true,type:'localStorage',storageKey:'xenforma'};grid_properties.scrolling={mode:"infinite"};grid_properties.columns=this.state.columns;grid_properties.selection={mode:multiSelect?"multiple":"none",showCheckBoxesMode:multiSelect?"always":"none"};grid_properties.onEditorPreparing=function(info){if(info.parentType=='filterRow'){if(info.format=='shortTime'){info.editorOptions.format="time";}else if(info.format=='shortdateshorttime'){info.editorOptions.format="datetime";}}};var nested_popup_func;if(grid_properties.export.enabled&&custom_properties.custom_export){grid_properties.onContentReady=function(){$('.dx-datagrid-export-button').each(function(){if(typeof $(this).data("custom-export")=="undefined"){$(this).data("custom-export",'');$("#"+context.state.grid_id).dxDataGrid("instance")._controllers.export.selectionOnly(true);$(this).on("click",function(){ // hack for devExtreme dxContextMenu
if($("#"+context.state.grid_id).dxDataGrid("instance")._views.headerPanel._exportContextMenu._dataAdapter.getData().lenght==3)return; // we already added an item
$("#"+context.state.grid_id).dxDataGrid("instance")._views.headerPanel._exportContextMenu._dataAdapter.getData().push({icon:"doc",text:custom_properties.custom_export.caption,internalFields:{childrenKeys:[]}});$('.dx-datagrid-export-menu .dx-submenu ul.dx-menu-items-container').each(function(){var children=this.children[0];$(children).after('<li class="dx-menu-item-wrapper dx-menu-item-wrapper-custom-import"><div class="dx-item dx-menu-item dx-menu-item-has-text dx-menu-item-has-icon"><div class="dx-item-content dx-menu-item-content"><i class="dx-icon dx-icon-doc"></i><span class="dx-menu-item-text">'+custom_properties.custom_export.caption+'</span></div></div></li>');});$('.dx-menu-item-wrapper-custom-import').on("click",function(e){ // to prevent devExtreme event handler
e.stopPropagation();send_data={};send_data.format=custom_properties.custom_export.format;if($("#"+context.state.grid_id).dxDataGrid("instance")._views.headerPanel._exportController.selectionOnly()){send_data.data=$("#"+context.state.grid_id).dxDataGrid("instance").getSelectedRowKeys().map(function(currentValue,index,arr){return currentValue._id;});}else {send_data.gridConditions=context.stats.export_grid_conditions;}var error=function(err){context.setState({error:err.message});};var success=function(data){$("#"+context.state.grid_id).dxDataGrid("instance")._views.headerPanel._exportContextMenu.hide();};invoke_method(context.state.entity_attributes.entity,"custom_export",send_data,success,error);});});}});};}if(this.state.app_object.edit_app_object){if(this.props.skip_init){if(!custom_properties.edit_in_grid){nested_popup_func=function(data_row,is_new){var app_object={};app_object.code=context.state.app_object.edit_app_object;app_object.type="edit_form";app_object._id=data_row._id;app_object=$.extend({},context.state.app_object,app_object);var data={};data.app_object=app_object;data.entity_attributes=context.state.entity_attributes;data.nested_list_entities=context.props.nested_list_entities;data.workflow_states=app_object.workflow_states;data.entity_instance=data_row;data.parent_entity_array=context.props.parent_entity_array;data.parent_entity_field_attribute=context.props.parent_entity_field_attribute;data.parent_react_entity=context.props.parent_react_entity;data.is_new_instance=is_new;return context.props.nested_entity_handler(data);};grid_properties.onEditingStart=function(event){event.cancel=true;var data_row=event.data;if(data_row._id){data_row=$.extend(true,{},data_row);return nested_popup_func(data_row);}};}}else {grid_properties.onEditingStart=function(event){event.cancel=true;var data_row=event.data;if(data_row._id){var app_object={};app_object.code=context.state.app_object.edit_app_object;app_object.type="edit_form";app_object._id=data_row._id;context.props.app_object_handler(app_object);}};var temp_grid_properties=$.extend({},grid_properties);context.state.entity_instances=context.state.entity_instances||[];temp_grid_properties.dataSource=context.state.entity_instances;temp_grid_properties.visible=false;$("#"+"hidden_export_"+this.state.grid_id).dxDataGrid(temp_grid_properties);var export_success_func=function(data){context.state.entity_instances.length=0; //delete all of these
context.state.entity_instances.push.apply(context.state.entity_instances,data.entity_instances);var temp_grid=$("#"+"hidden_export_"+context.state.grid_id).dxDataGrid("instance");temp_grid.refresh();temp_grid.selectAll();temp_grid.exportToExcel(true);$("#loader").dxLoadPanel({message:R.label_loading,showIndicator:false,visible:false,position:{of:"#"+context.state.grid_id},shadingColor:"rgba(0,0,0,0.4)"});};var export_error_func=function(error){if(error.responseJSON){console.log([R.client_export_to_excel_failed,error.responseJSON]);context.setState({error:error.responseJSON.message});}};grid_properties.onExporting=function(event){event.cancel=true;$("#loader").dxLoadPanel({message:R.label_loading,showIndicator:false,visible:true,position:{of:"#"+context.state.grid_id},shadingColor:"rgba(0,0,0,0.4)"});invoke_method(context.state.entity_attributes.entity,"find_all",send_data,export_success_func,export_error_func);};}}for(var property in custom_properties){grid_properties[property]=custom_properties[property];}grid_properties.editing={editMode:"row",texts:{editRow:custom_properties.editable?R.edit:R.view},editEnabled:true,removeEnabled:!custom_properties.disable_delete&&custom_properties.editable,insertEnabled:!custom_properties.disable_create&&custom_properties.editable};if(!this.props.skip_init){var success=function(data){if(context.state.entity_attributes&&context.state.entity_attributes.entity=='translation'){load_translations(false,context.forceUpdate);}Notify(data.message,'bottom-right',20000,'green','fa-check',true);};var complete=function(){$("#loader").dxLoadPanel({message:R.label_loading,showIndicator:false,visible:false,position:{of:"#"+context.state.grid_id},shadingColor:"rgba(0,0,0,0.4)"});};grid_properties.onRowUpdating=function(e){$("#loader").dxLoadPanel({message:R.label_loading,showIndicator:false,visible:true,position:{of:"#"+context.state.grid_id},shadingColor:"rgba(0,0,0,0.4)"});var _id=e.key._id;var update_data=e.newData;update_data._id=_id;var entity=context.state.entity_attributes.entity;var error=function(err){context.setState({error:err.message});e.component.cancelEditData();};invoke_method(entity,"upsert",update_data,success,error,complete);return true;};grid_properties.onRowInserting=function(e){$("#loader").dxLoadPanel({message:R.label_loading,showIndicator:false,visible:true,position:{of:"#"+context.state.grid_id},shadingColor:"rgba(0,0,0,0.4)"});var document=e.data;var entity=context.state.entity_attributes.entity;var error=function(err){context.setState({error:err.message});e.component.cancelEditData();};invoke_method(entity,"upsert",document,success,error,complete);};grid_properties.onRowRemoving=function(e){$("#loader").dxLoadPanel({message:R.label_loading,showIndicator:false,visible:true,position:{of:"#"+context.state.grid_id},shadingColor:"rgba(0,0,0,0.4)"});var _id=e.data._id;var entity=context.state.entity_attributes.entity;var error=function(err){context.setState({error:err.message});};invoke_method(entity,"delete",{_id:_id},success,error,complete);};grid_properties.onContentReady=function(e){$("#"+context.state.grid_id+' *[aria-label="edit-button-addrow"]').click(function(){var app_object={};app_object.code=context.state.app_object.edit_app_object;app_object.type="edit_form";context.props.app_object_handler(app_object);});};}else {var on_change=function(e){if(context.props.on_change){context.props.on_change(context.state.entity_instances);}};grid_properties.onRowUpdating=on_change;grid_properties.onRowInserting=on_change;grid_properties.onRowRemoving=on_change;if(nested_popup_func){grid_properties.onContentReady=function(e){$("#"+context.state.grid_id+' *[aria-label="edit-button-addrow"]').click(function(){var data_row={};return nested_popup_func(data_row,true);});};}}$("#"+this.state.grid_id).dxDataGrid(grid_properties);},render:function(){var columns=[];var context=this;for(var i=0;this.state.entity_attributes&&i<this.state.entity_attributes.attributes.length;i++){var attribute=this.state.entity_attributes.attributes[i];if(!attribute.list_visible){continue;}if(attribute.type=="Mixed"||attribute.is_array){continue;}var column={dataField:attribute.field_path,caption:attribute.caption};if(attribute.list_of_values){var tempAttribute=attribute.list_of_values;column.allowHeaderFiltering=true;column.headerFilter={dataSource:{load:function(loadOptions){var res=[];for(var i=0;i<tempAttribute.length;i++){res.push({text:tempAttribute[i].value,value:tempAttribute[i].code});}return res;}}};}else {column.allowHeaderFiltering=false;}var type=attribute.attribute_type==null?attribute.db_type:attribute.attribute_type;switch(type){case "Image":column.cellTemplate=function(container,options){if(options.value){$("<img style='max-width:50px;max-height:50px'/>").attr("src",options.value).appendTo(container);}};column.allowFiltering=false;break;case "Recurrent":column.allowFiltering=false;column.cellTemplate=function(container,options){if(options.value){var value=options.value;if(value.slice(0,6)=='RRULE:'){value=value.substr(6);}container.html(RRule.fromString(value).toText());}};break;case "Html":column.cellTemplate=function(container,options){if(options.value&&options.value!=''){$("<a href='#'>View</a>").on('click',function(e){context.popup.option('title',options.column.caption);context.popup.show();$('#'+context.state.scrollViewContentElementId).html(options.value);e.preventDefault();}).appendTo(container);}};break;case "YesNo":column.falseText=R.label_no;column.trueText=R.label_yes;column.cellTemplate=function(container,options){if(options.value&&options.value!=''){container.html(R.label_yes);}else {container.html(R.label_no);}};break;case "Boolean":break;case "CheckBox":break;case "MaskedTextBox":break;case "MultiLineTextBox": // https://www.devexpress.com/Support/Center/Question/Details/T298005
break;case "Date":column.dataType='date';break;case "DateTime":var tempColumn=column;column.format='shortdateshorttime';column.dataType='date';column.calculateFilterExpression=function(filterValue,selectedFilterOperation){filterValue.setSeconds(0);return [function(){return tempColumn.dataField;},selectedFilterOperation||'=',filterValue];};break;case "Time":column.format='shortTime';column.dataType='date';break;case "user":{if(attribute.is_nested_entity&&attribute.data_is_nested==false&&!attribute.is_array){column.cellTemplate=function(container,options){if(typeof options.value=="object"&&options.value!=null){var name=options.value.caption||options.value.entity_id;container.html(name);if(options.value.image){$("<span>&nbsp;</span>").prependTo(container);$("<img style='max-width:15px;max-height:15px'/>").attr("src",options.value.image).prependTo(container);}options.displayValue=name;}else {return options.value;}};}break;}case "ref_sub":{column.cellTemplate=function(container,options){if(typeof options.value=="object"&&options.value!=null){var name=options.value.caption||options.value.entity_id;container.html(name);options.displayValue=name;}else {return options.value;}};break;}default:break;}columns.push(column);}this.state.columns=columns;var app_object_name=this.state.app_object?this.state.app_object.name:"";var error_component="";if(this.state.error){error_component=React.createElement("div",null,React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:this.on_error_close}),React.createElement("br",null));}var export_component="";var close_button;if(!this.props.skip_init){ //add a close button
close_button=React.createElement("button",{onClick:this.handle_close,className:"btn btn-close"},'X');close_button=React.createElement("div",null,React.createElement("span",{className:"widget-caption"},close_button));export_component=React.createElement("div",{id:"hidden_export_"+this.state.grid_id});}var context=this;return React.createElement("div",{className:"widget"},React.createElement("div",{className:"widget-header bordered-bottom bordered-palegreen"},React.createElement("span",{className:"widget-caption"},app_object_name),React.createElement("div",{className:"widget-buttons"},close_button)),React.createElement("div",{className:"widget-body"},error_component,React.createElement("div",{id:"loader"}),React.createElement("div",{id:this.state.grid_id}),export_component),React.createElement("div",{ref:function(ref){context.popupElement=ref;}},React.createElement("div",{ref:function(ref){context.popupContentElement=ref;}},React.createElement("div",{id:this.state.scrollViewContentElementId}))));}});var EditFormComponent=React.createClass({displayName:"EditFormComponent",getInitialState:function(){var state_object=this.initialize_edit_form();if(state_object){return state_object;}return {workflow_comment:"",update_fields:{}};},componentDidUpdate:function(){return this.custom_post_render_logic();},componentDidMount:function(){return this.custom_post_render_logic();},custom_post_render_logic:function(){$('.date-picker').datepicker();for(var i=0;this.state.entity_attributes&&i<this.state.entity_attributes.attributes.length;i++){var attribute=this.state.entity_attributes.attributes[i];if(!attribute.form_visible){continue;}var info_id="#info_"+attribute.field_path.replace(/:/g,'-');var popover_desc=$(info_id+"_desc").dxPopover({target:info_id,position:"top",width:300}).dxPopover("instance");var appear=function(popover){return function(){popover.show();};};var disappear=function(popover){return function(){popover.hide();};};$(info_id).hover(appear(popover_desc),disappear(popover_desc));}if(this.state.workflow_states&&!this.state.workflow_comment_popup){this.state.workflow_comment_popup=$("#workflow_comment_popup").dxPopup({width:400,height:250,showTitle:false}).dxPopup("instance");}},componentWillUnmount:function(){ //current_navigation_listener = undefined;
if(this.state.workflow_states){var workflow_comment_popup=$("#workflow_comment_popup").dxPopup("instance");if(workflow_comment_popup){workflow_comment_popup.hide();}}if(this.state.modified){this.state.modified=false;}},initialize_edit_form:function(){var context=this;var given_data=this.props.data;var is_new_instance=false;var success=function(data){data=data.data;console.log("workflow:data");console.log(data);data=$.extend({},given_data,data);data.is_new_instance=is_new_instance;if(is_new_instance){context.populate_update_fields(data.entity_attributes,data.values);}if(data.app_object&&data.app_object.workflow_states){data.workflow_states=data.app_object.workflow_states;delete data.app_object.workflow_states;}if(data.values){data.entity_instance=data.values;delete data.values;}var caption=data.app_object.name&&data.app_object.name.trim()!=""?data.app_object.name:data.entity_attributes.caption_singular;if(data.entity_attributes.caption_fields&&data.entity_attributes.caption_fields.length>0){data.caption_function=function(entity_data){return make_friendly_caption(data.entity_attributes.caption_fields,entity_data);};if(!is_new_instance){caption=data.caption_function(data.entity_attributes.attributes);}}context.setState(data);var _id;_id=request._id;_id=_id?"&_id="+_id:"";if(!data.parent_react_entity){push_href_location(caption+" - "+(R.client_application_title||"Xenforma"),"/edit_form?code="+(data.app_object_code||data.app_object.code)+_id);}context.post_init();};var error=function(err){context.setState({error:err.message});};if(given_data&&!given_data.is_reference_nest){ //nested edit_form
if(given_data.is_new_instance){is_new_instance=true; //given_data.update_fields = context.populate_update_fields(given_data.entity_attributes, {});
}else {given_data.update_fields={};context.post_init(given_data.entity_attributes);var caption=given_data.entity_attributes.caption_singular;if(given_data.entity_attributes.caption_fields&&given_data.entity_attributes.caption_fields.length>0){given_data.caption_function=function(entity_data){return make_friendly_caption(given_data.entity_attributes.caption_fields,entity_data);};}return given_data;}}else { //top-level edit_form
current_navigation_listener=function(callback){if(context.state.modified){return display_yes_no_dialogue(R.label_confirm,R.message_changes_discarded,function(confirmation){if(confirmation){return callback(true);}else {return callback(false);}});}else {return callback(true);}};}var request={app_object_code:this.props.app_object_code||this.props.data.app_object_code||this.props.data.app_object.code,separate_values:true};if(this.props._id){request._id=this.props._id;}else if(this.state&&this.state.is_new_instance!=undefined){request._id=this.state._id;is_new_instance=this.state.is_new_instance;}else {is_new_instance=true;}return invoke_method("app_object","get_by_code",request,success,error);},post_init:function(entity_attributes){var context=this;if(!entity_attributes){entity_attributes=this.state.entity_attributes;}for(var i=0;entity_attributes&&i<entity_attributes.attributes.length;i++){var attribute=entity_attributes.attributes[i];if(!attribute.form_visible){continue;}if(attribute.is_nested_entity&&attribute.data_is_nested==false){ //if (attribute.is_array)
this.refresh_reference_grid(attribute);}}},refresh_reference_grid:function(attribute,callback){var context=this; //if (attribute.is_nested_entity && attribute.data_is_nested == false && attribute.is_array) {
var entity=attribute.db_type;var request={};request.app_object_code=this.props.app_object_code||this.props.data.app_object_code||this.props.data.app_object.code;var success=(function(attribute){return function(data){data=data.data;if(!attribute.select_options){attribute.select_options=[];}attribute.select_options.length=0;attribute.select_options.push.apply(attribute.select_options,data); //attribute.select_options = data;
if(callback){callback(data);}context.forceUpdate();};})(attribute);var error=function(error){console.log(error);};invoke_method(entity,"read_with_nested_permissions",request,success,error); //}
},populate_update_fields:function(entity_attributes,entity_instance_data,out_val){if(!out_val){out_val=this.state.update_fields||{};}for(var i=0;i<entity_attributes.attributes.length;i++){var attribute=entity_attributes.attributes[i];if(attribute.form_visible){var attribute_value;attribute_value=entity_instance_data[attribute.field_path];out_val[attribute.field_path]=attribute_value;}}return out_val;},on_file_name_change:function(attribute,file){if(file){this.state.update_fields['file_name']=file.name;this.state.entity_instance['file_name']=file.name;}else {this.state.update_fields['file_name']=null;this.state.entity_instance['file_name']=null;}this.setState({fileToUpload:file});},on_file_upload_end:function(attribute){this.state.update_fields['date_uploaded']=new Date();this.state.entity_instance['date_uploaded']=new Date();this.state.update_fields['uploaded']=true;this.state.entity_instance['uploaded']=true;this.setState({fileToUpload:undefined,uploadFileModal:false,resetFileUpload:true});this.handle_submit();},on_file_upload_cancel:function(attribute,event){this.setState({uploadFileModal:false});},on_field_change:function(attribute,event){if(!this.state.modified){this.state.modified=true;}if(attribute){var new_value;var type=attribute.attribute_type==null?attribute.db_type:attribute.attribute_type;if(event==null){new_value=event; // event is data
}else if(event.target){switch(type){case "Boolean":new_value=event.target.checked;break;default:new_value=event.target.value;break;}}else if(event.component){ // Data coming from entity reference lookup
new_value=event.component._valuesData; // Data is coming from DevExtreme component
}else {new_value=event; // event is data
}this.state.update_fields[attribute.field_path]=new_value;this.state.entity_instance[attribute.field_path]=new_value;if(attribute.revalidate_on_field_changed){attribute.modified=true;}this.forceUpdate();}},on_field_blur:function(attribute,event){if(attribute.revalidate_on_field_changed&&attribute.modified){delete attribute.modified;var attribute_value=this.state.entity_instance[attribute.field_path];var entity_name=this.state.entity_attributes.entity;var request={};request.field_path=attribute.field_path;request.entity_instance={};if(attribute.validation_requires_full_entity){request.entity_instance=this.state.entity_instance;}else {request.entity_instance[attribute.field_path]=attribute_value;}var context=this;var success=function(data){if(data.success){var updated_view_data=data.updated_view_data;var entity_attributes=context.state.entity_attributes;var modify_state=false;for(var field_path in updated_view_data){var entity_attribute_update=updated_view_data[field_path];var entity_attribute=get_attribute_for_field(entity_attributes,field_path);if(entity_attribute){for(var field_attribute in entity_attribute_update){if(field_attribute!="errors"){entity_attribute[field_attribute]=entity_attribute_update[field_attribute];modify_state=true;}else {if(entity_attribute_update.errors&&entity_attribute_update.errors.length>0){context.state.error=entity_attribute_update.errors[0]; // TODO: Handling for multiple errors
modify_state=true;}}}}}if(modify_state){context.forceUpdate();}}};var error=function(err){console.log(err);};invoke_method(entity_name,"execute_business_rule",request,success,error);}},delete_nested_entity:function(nested_entity_field_attribute,nested_entity_array,entity_id){var nested_entity_index=find_index_by_id(nested_entity_array,entity_id);if(nested_entity_index!=null){nested_entity_array.splice(nested_entity_index,1);}this.close_nested_entity_view();return this.on_field_change(nested_entity_field_attribute,nested_entity_array);},upsert_nested_entity:function(nested_entity_field_attribute,nested_entity_array,entity_inst_deltas){var entity_id=entity_inst_deltas._id;var has_change=true;var nested_entity_index=find_index_by_id(nested_entity_array,entity_id);if(nested_entity_index!=null){has_change=false;for(var field_name in entity_inst_deltas){if(field_name!="_id"){has_change=true;break;}}$.extend(nested_entity_array[nested_entity_index],entity_inst_deltas);}else {nested_entity_array.push(entity_inst_deltas);}this.close_nested_entity_view();if(has_change){return this.on_field_change(nested_entity_field_attribute,nested_entity_array);}},close_nested_entity_view:function(added_id){delete this.state.child_entity_state_data;var context=this;if(this.state.nested_reference_entity_data){var attribute=this.state.nested_reference_entity_data.attribute;this.refresh_reference_grid(attribute,function(data_list){if(data_list){for(var i=0;i<context.state.entity_instance[attribute.field_path].length;i++){if(typeof context.state.entity_instance[attribute.field_path][i]=="object"){context.state.entity_instance[attribute.field_path][i]=context.state.entity_instance[attribute.field_path][i]["entity_id"];}}for(var i=0;i<data_list.length;i++){if(data_list[i].entity_id==added_id){ //add to tagbox list:
context.state.entity_instance[attribute.field_path].push(added_id);context.forceUpdate();return;}}}});delete this.state.nested_reference_entity_data;}this.state.areButtonsDisabled=false;this.setState(this.state);},handle_close:function(event){if(event&&event.preventDefault){event.preventDefault();}var context=this;var close_func;if(context.props.data&&context.props.data.parent_react_entity){if(context.state.modified){return display_yes_no_dialogue(R.label_confirm,R.message_changes_discarded,function(confirmation){if(confirmation){return context.props.data.parent_react_entity.close_nested_entity_view();}});}else {return context.props.data.parent_react_entity.close_nested_entity_view();}}else {close_func=function(){current_navigation_listener=undefined;if(window.history.length&&window.history.length>1){window.history.back();}else {context.props.navigation_handler("home");}};}if(current_navigation_listener){return current_navigation_listener(function(result){if(result){return close_func();}});}else {return close_func();}},handle_submit:function(event,view_options){if(event&&event.preventDefault){event.preventDefault();}var context=this;var entity_method;var send_data=this.state.update_fields;context.state.update_fields._id=this.state.entity_instance._id;var error=function(err){context.setState({error:err.message});};var success;if(context.props.data&&context.props.data.parent_react_entity&&!context.props.data.is_reference_nest){ //don't save directly, but do validate first.
if(!context.state.update_fields){return context.props.data.parent_react_entity.close_nested_entity_view();}send_data=context.state.entity_instance; //validate whole entity as a stand-alone (for now).
success=function(data){return context.props.data.parent_react_entity.upsert_nested_entity(context.state.parent_entity_field_attribute,context.state.parent_entity_array,context.state.update_fields);};}else {success=function(data){if(context.state.is_new_instance){if(data.data&&data.data._id){context.state._id=data.data._id;}}if(context.state.fileToUpload){context.setState({uploadFileModal:true});return;}if(view_options&&view_options.confirmation_message){Notify(view_options.confirmation_message,'bottom-right',20000,'green','fa-check',true);}else {Notify(data.message,'bottom-right',20000,'green','fa-check',true);}if(context.state.entity_attributes&&context.state.entity_attributes.entity=='translation'){load_translations(false,context.forceUpdate);}if(context.state.app_object&&context.state.app_object.custom_properties&&context.state.app_object.custom_properties.refresh_user_data){context.props.update_avatar();context.props.update_user_info();}if(context.props.data&&context.props.data.is_reference_nest){ //nested edit form
context.props.data.parent_react_entity.close_nested_entity_view(context.state._id);return context.props.data.parent_react_entity.on_field_change(context.state.parent_entity_field_attribute,context.state.parent_entity_array);}else {if(view_options){if(view_options.skip_refresh){return context.props.navigation_handler("home");}}context.setState({update_fields:{},error:undefined,modified:false,workflow_comment:"",workflow_action:undefined,workflow_constructor:undefined,is_new_instance:false,resetFileUpload:undefined});context.handle_close(event);context.initialize_edit_form();}};}entity_method="upsert";if(context.state.workflow_constructor||context.state.workflow_action){if(!context.props.data||context.props.data.is_reference_nest){ //direct nests don't invoke workflow
entity_method="change_workflow_state";}var comment;if(context.state.workflow_constructor){context.state.update_fields.constructor_used=context.state.workflow_constructor.name;if(context.state.workflow_constructor.comment){comment=context.state.workflow_comment;}}else if(context.state.workflow_action){if(context.state.workflow_action.comment){comment=context.state.workflow_comment;}}if(comment){context.state.update_fields.workflow_comment=comment;}}console.log("send_data");console.log(send_data);invoke_method(context.state.entity_attributes.entity,entity_method,send_data,success,error);},handle_delete:function(event){event.preventDefault();var context=this;display_yes_no_dialogue(R.label_delete_title,R.message_delete_entity,function(confirmation){if(confirmation){if(context.props.data&&context.props.data.parent_react_entity){return context.props.data.parent_react_entity.delete_nested_entity(context.state.parent_entity_field_attribute,context.state.parent_entity_array,context.state.entity_instance._id);}else {var success=function(data){context.setState({update_fields:{},error:undefined});Notify(data.message,'bottom-right',20000,'green','fa-check',true);if(context.state.entity_attributes&&context.state.entity_attributes.entity=='translation'){load_translations(false,context.forceUpdate);}context.setState({modified:false});context.props.navigation_handler("home");};var error=function(err){context.setState({error:err.message});};var data={_id:context.state.entity_instance._id};return invoke_method(context.state.entity_attributes.entity,"delete",data,success,error);}}});},handle_workflow_action_click:function(action,status,event,is_constructor){event.preventDefault();this.state.update_fields.workflow_status=status;if(is_constructor){this.state.workflow_constructor=action;}else {this.state.workflow_action=action;}if(action&&action.view_options){if(action.confirmation_message){action.view_options.confirmation_message=action.confirmation_message; //for easy passing to handle_submit
}}if(action&&action.comment){var context=this;$("#workflow_comment_popup").dxPopup("instance").show();$("#workflow_comment_popup_submit").click(function(){if(context.state.workflow_comment.length==0){Notify(R.message_enter_workflow_comment,'bottom-right',10000,'red','fa-check',true);}else {$("#workflow_comment_popup").dxPopup("instance").hide();context.handle_submit(null,action.view_options);}});$("#workflow_comment_popup_cancel").click(function(){$("#workflow_comment_popup").dxPopup("instance").hide();});$("#workflow_comment_text").keyup(function(){context.state.workflow_comment=$("#workflow_comment_text").val();});}else {if(action){this.handle_submit(null,action.view_options);}else {this.handle_submit();}}},nested_entity_handler:function(child_entity_state_data){this.state.child_entity_state_data=child_entity_state_data;this.state.areButtonsDisabled=true;return this.forceUpdate();},reference_entity_handler:function(reference_entity_attribute,reference_entity_id){this.state.nested_reference_entity_data={reference_entity_name:reference_entity_attribute.db_type,reference_entity_id:reference_entity_id,attribute:reference_entity_attribute,value:this.state.entity_instance[reference_entity_attribute.field_path]};this.state.areButtonsDisabled=true;return this.forceUpdate();},form_is_read_only:function(){return this.state&&this.state.app_object&&this.state.app_object.custom_properties&&!this.state.app_object.custom_properties.editable;},render:function(){var edit_form=null;var input_array=[];var context=this;if(this.state.nested_reference_entity_data){ //popup reference entity edit form
var ref_data={is_reference_nest:true,parent_react_entity:this,app_object_code:this.state.nested_reference_entity_data.reference_entity_name+"_default_edit_form",key:this.state.nested_reference_entity_data.reference_entity_name+"_default_edit_form"+this.state.reference_entity_id,parent_entity_field_attribute:this.state.nested_reference_entity_data.attribute,parent_entity_array:this.state.nested_reference_entity_data.value};var input_element; //if(this.state.reference_entity_id) {
input_element=React.createElement(EditFormComponent,{data:ref_data,app_object_handler:this.props.app_object_handler,_id:this.state.reference_entity_id,key:this.state.reference_entity_id,navigation_handler:this.props.navigation_handler}); //}
//else {
//    input_element = <EditFormComponent data = {ref_data} app_object_handler = {this.props.app_object_handler} navigation_handler = {this.props.navigation_handler} />;
//}
var input_div=React.createElement("div",{className:"form-group",key:"div-"+input_element.key},React.createElement("div",{className:"col-sm-12"},input_element));edit_form=input_div;}else if(this.state.child_entity_state_data){ /*var data = {
             app_object,
             entity_attributes,
             nested_list_entities,
             workflow_states,
             entity_instance,
             parent_entity_array,
             parent_entity_field_attribute,
             parent_react_entity,
             is_new_instance
             };*/var input_element=React.createElement(EditFormComponent,{data:context.state.child_entity_state_data});var input_div=React.createElement("div",{className:"form-group",key:"div-child-entity-"+input_element.key},React.createElement("div",{className:"col-sm-12"},input_element));edit_form=input_div;}else {var row_name;var row_array=null;var same_row_count;for(var i=0;this.state.entity_attributes&&i<this.state.entity_attributes.attributes.length;i++){var attribute=this.state.entity_attributes.attributes[i];if(!attribute.form_visible){continue;}var attribute_value;var attribute_caption_image;attribute_value=this.state.entity_instance[attribute.field_path];attribute_caption_image=null;if(attribute_value&&typeof attribute_value=="object"&&attribute.is_nested_entity&&attribute.data_is_nested==false&&!attribute.is_array){if(attribute_value.image){attribute_caption_image=attribute_value.image;}attribute_value=attribute_value.caption||attribute_value.entity_id;}var same_row=attribute.same_row;if(same_row){row_name=same_row;same_row_count=0;for(var k=0;k<this.state.entity_attributes.attributes.length;k++){if(this.state.entity_attributes.attributes[k].same_row&&this.state.entity_attributes.attributes[k].same_row==row_name){same_row_count++;if(row_array==null){row_array=[];}}}}var input_element;var omit_caption=attribute.hide_caption;if(attribute.is_array&&attribute.is_nested_entity&&attribute.data_is_nested){var entity=attribute.db_type;var nested_list_entities=this.state.nested_list_entities;if(this.props.data&&this.props.data.nested_list_entities){nested_list_entities=this.props.data.nested_list_entities;}var data_list_object=nested_list_entities[entity];var app_object=data_list_object.app_object;if(this.form_is_read_only()){app_object.custom_properties.editable=false;}else {app_object.custom_properties.editable=!attribute.read_only;}var entity_attributes=data_list_object.entity_attributes;var entity_instances=attribute_value;if(!entity_instances){this.state.entity_instance[attribute.field_path]=[];entity_instances=this.state.entity_instance[attribute.field_path];}input_element=React.createElement(DataListComponent,{skip_init:true,read_only:attribute.read_only||this.form_is_read_only(),nested_list_entities:nested_list_entities,parent_react_entity:this,parent_entity_field_attribute:attribute,parent_entity_array:entity_instances,app_object:app_object,entity_attributes:entity_attributes,entity_instances:entity_instances,key:app_object.code,app_object_handler:this.props.app_object_handler,nested_entity_handler:this.nested_entity_handler,on_change:this.on_field_change.bind(this,attribute)});omit_caption=true;}else if(attribute.is_nested_entity&&attribute.data_is_nested==false){if(attribute.is_array){if(!attribute_value){this.state.entity_instance[attribute.field_path]=[];attribute_value=this.state.entity_instance[attribute.field_path];}if(attribute.select_options){ //var mount_callback = function(att) {return function() {context.refresh_reference_grid(att);};}(attribute);
if(this.state.entity_attributes.reference_entities[attribute.db_type]&&this.state.entity_attributes.reference_entities[attribute.db_type].entity_access&&this.state.entity_attributes.reference_entities[attribute.db_type].entity_access.indexOf('c')!=-1){ //add a + sign.
input_element=(function(local_attribute){var add_func=function(){context.reference_entity_handler(local_attribute);};var addButton='';if(!(local_attribute.read_only||context.form_is_read_only())){addButton=React.createElement("button",{className:"edit-controls-add-button dx-button",onClick:add_func},React.createElement("div",{className:"dx-button-content"},React.createElement("i",{className:"dx-icon dx-icon-edit-button-addrow"})));}return React.createElement("div",null,React.createElement(EditorDevExtremeTagBox,{key:local_attribute.field_path,tagbox_holder:local_attribute,dataSource:local_attribute.select_options,displayExpr:"caption",valueExpr:"entity_id",values:context.state.entity_instance[local_attribute.field_path],onChange:context.on_field_change.bind(context,local_attribute),add_button:addButton==''?false:true,readOnly:local_attribute.read_only||context.form_is_read_only()}),addButton);})(attribute);}else {input_element=React.createElement(EditorDevExtremeTagBox,{key:attribute.field_path,tagbox_holder:attribute,dataSource:attribute.select_options,displayExpr:"caption",valueExpr:"entity_id",values:attribute_value,onChange:context.on_field_change.bind(context,attribute),readOnly:attribute.read_only||this.form_is_read_only()});}}else {continue;}}else {if(attribute.select_options){attribute_value=this.state.entity_instance[attribute.field_path];if(attribute_value){attribute_value=attribute_value.entity_id;}input_element=(function(local_attribute){var addButton='';if(context.state.entity_attributes.reference_entities[local_attribute.db_type]&&context.state.entity_attributes.reference_entities[local_attribute.db_type].entity_access&&context.state.entity_attributes.reference_entities[local_attribute.db_type].entity_access.indexOf('c')!=-1){ //add a + sign.
var add_func=function(){context.reference_entity_handler(local_attribute);};if(!(local_attribute.read_only||context.form_is_read_only())){addButton=React.createElement("button",{className:"edit-controls-add-button dx-button",onClick:add_func},React.createElement("div",{className:"dx-button-content"},React.createElement("i",{className:"dx-icon dx-icon-edit-button-addrow"})));}}return React.createElement("div",null,React.createElement(EditorDevExtremeSelectBox,{dataSource:attribute.select_options,displayExpr:"caption",valueExpr:"entity_id",value:attribute_value,onChange:context.on_field_change.bind(context,attribute),add_button:addButton==''?false:true,readOnly:attribute.read_only||context.form_is_read_only()}),addButton);})(attribute);}}}else if(attribute.list_of_values){var list_of_values=attribute.list_of_values;if(attribute.is_array){input_element=React.createElement(EditorDevExtremeTagBox,{dataSource:list_of_values,displayExpr:"value",valueExpr:"code",values:attribute_value,onChange:context.on_field_change.bind(context,attribute),readOnly:attribute.read_only||this.form_is_read_only()});}else {var options=[];for(var j=0;j<list_of_values.length;j++){var lov=list_of_values[j];var option=React.createElement("option",{key:lov.code,value:lov.code},lov.value);options.push(option);}input_element=React.createElement("select",{className:"form-control",defaultValue:attribute_value,key:attribute.field_path,readOnly:attribute.read_only||this.form_is_read_only(),disabled:attribute.read_only||this.form_is_read_only(),onChange:this.on_field_change.bind(this,attribute)},options);if(attribute_value==null&&list_of_values.length>0){var lov=list_of_values[0];this.state.update_fields[attribute.field_path]=lov.code;this.state.entity_instance[attribute.field_path]=lov.code;}}}else {var type=attribute.attribute_type==null?attribute.db_type:attribute.attribute_type;switch(type){case "Image":var resizeWidth=null;var resizeHeight=null;if(attribute.custom_properties){if(attribute.custom_properties.max_height&&attribute.custom_properties.max_width){resizeWidth=attribute.custom_properties.max_width;resizeHeight=attribute.custom_properties.max_height;}}input_element=React.createElement(EditorDevExtremeImageUpload,{onChange:this.on_field_change.bind(this,attribute),value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only(),resizeWidth:resizeWidth,resizeHeight:resizeHeight,key:attribute.field_path,selectButtonText:R_loc.select_image});break;case "File":input_element=React.createElement(EditorFileUpload,{onFileNameChange:this.on_file_name_change.bind(this,attribute),onChange:this.on_field_change.bind(this,attribute),fileName:this.state.entity_instance["file_name"],value:this.state.entity_instance._id,resetFileUpload:this.state.resetFileUpload,key:attribute.field_path,readOnly:attribute.read_only||this.form_is_read_only()});break;case "Html":input_element=React.createElement(EditorHtml,{onChange:this.on_field_change.bind(this,attribute),key:attribute.field_path,value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only()});break;case "YesNo":input_element=React.createElement(EditorDevExtremeSwitchYesNo,{onChange:this.on_field_change.bind(this,attribute),key:attribute.field_path,value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only()});break;case "Boolean":input_element=React.createElement("label",null,React.createElement("input",{className:"form-control checkbox-slider colored-blue",type:"checkbox",key:attribute.field_path,onChange:this.on_field_change.bind(this,attribute),checked:attribute_value,readOnly:attribute.read_only||this.form_is_read_only(),disabled:attribute.read_only||this.form_is_read_only()}),React.createElement("span",{className:"text"}));break;case "CheckBox":input_element=React.createElement(EditorDevExtremeCheckBox,{onChange:this.on_field_change.bind(this,attribute),key:attribute.field_path,value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only()});break;case "MaskedTextBox":var mask_data=attribute.mask_data||{};var mask_rules=mask_data.mask_rules;if(mask_rules){for(var field_name in mask_rules){mask_rules[field_name]=try_parse_regexp(mask_rules[field_name]);}}input_element=React.createElement(EditorDevExtremeMaskedTextBox,{onChange:this.on_field_change.bind(this,attribute),key:attribute.field_path,value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only(),mask:mask_data.mask,maskRules:mask_data.mask_rules,maskChar:mask_data.mask_char||"_",useMaskedValue:mask_data.use_masked_value,rtlEnabled:attribute.right_to_left||false});break;case "Recurrent":input_element=React.createElement(EditorRecurrenceInput,{onChange:this.on_field_change.bind(this,attribute),value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only(),key:attribute.field_path,placeholder:attribute.caption});break;case "MultiLineTextBox":input_element=React.createElement(EditorDevExtremeMultiLineTextBox,{onChange:this.on_field_change.bind(this,attribute),value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only(),key:attribute.field_path,placeholder:attribute.caption});break;case "Date":input_element=React.createElement(EditorDevExtremeDatePicker,{onChange:this.on_field_change.bind(this,attribute),key:attribute.field_path,value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only()});break;case "DateTime":input_element=React.createElement(EditorDevExtremeDateTimePicker,{onChange:this.on_field_change.bind(this,attribute),value:attribute_value,key:attribute.field_path,readOnly:attribute.read_only||this.form_is_read_only()});break;case "Time":input_element=React.createElement(EditorDevExtremeTimePicker,{onChange:this.on_field_change.bind(this,attribute),key:attribute.field_path,value:attribute_value,readOnly:attribute.read_only||this.form_is_read_only()});break;default:var style={};if(attribute_caption_image){style={"backgroundImage":"url("+attribute_caption_image+")","backgroundRepeat":"no-repeat","backgroundSize":"34px auto","textIndent":"28px"};}input_element=React.createElement("input",{type:"text",className:"form-control",key:attribute.field_path,placeholder:attribute.caption,value:attribute_value,onBlur:this.on_field_blur.bind(this,attribute),onChange:this.on_field_change.bind(this,attribute),readOnly:attribute.read_only||this.form_is_read_only(),style:style});break;}}var info_id="info_"+attribute.field_path.replace(/:/g,'-');var caption_label="";if(!omit_caption){if(!same_row){caption_label=React.createElement("div",{className:"col-sm-2 no-padding-right",style:{"textAlign":"right"}},React.createElement("label",{id:info_id,className:"control-label"},attribute.caption));}else {caption_label=React.createElement("div",{className:"col-sm-2 no-padding-right",style:{"textAlign":"right"}},React.createElement("label",{id:info_id,className:"control-label"},attribute.caption));}console.log(info_id);}var class_name="col-sm-10";if(omit_caption){class_name="col-sm-12";}var input_div;if(!same_row){if(row_name){ //ending a previous row
input_div=React.createElement("div",{className:"form-group",key:"QK-input-wrapper-row-name-"+row_name.toString()+"-"+info_id},row_array);input_array.push(input_div);row_array=null;row_name=null;}input_div=React.createElement("div",{className:"form-group",key:"QK-input-wrapper-"+info_id},caption_label,React.createElement("div",{className:class_name},input_element));input_array.push(input_div);info_id+="_desc";input_array.push(React.createElement("div",{id:info_id,key:"QK-input-wrapper-info-id"+info_id},attribute.description));}else { //same_row
var rowsCount=1;if(same_row_count==2){rowsCount=4;}if(same_row_count==3){rowsCount=2;}if(omit_caption){rowsCount=rowsCount+2;}class_name="col-sm-"+rowsCount;input_div=React.createElement("div",{key:"QK-row-array-"+info_id},caption_label,React.createElement("div",{className:class_name},input_element));row_array.push(input_div);info_id+="_desc";row_array.push(React.createElement("div",{id:info_id,key:"QK-row-array-info-id"+info_id},attribute.description));}}if(row_name){ //ending a previous row
input_div=React.createElement("div",{className:"form-group",key:"QK-input-wrapper-row-name-"+row_name.toString()+"-"},row_array);input_array.push(input_div);row_array=null;row_name=null;}}var error_component="";if(this.state.error){error_component=React.createElement("div",null,React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:this.on_error_close}),React.createElement("br",null));}var app_object_name,caption;if(this.state.caption_function){if(this.state.entity_instance){caption=this.state.caption_function(this.state.entity_instance);}else {caption=this.state.caption_function(this.state.entity_attributes.attributes);}}if(this.state.app_object&&this.state.app_object.name){app_object_name=this.state.app_object.name;}if(!caption||caption.trim()==""){caption=null;}if(this.state.entity_attributes&&this.state.entity_attributes.caption_singular){caption=this.state.entity_attributes.caption_singular+": "+(caption||" ");}var workflow_status="";var workflow_comment_popup="";var skip_save=this.form_is_read_only()||this.state.app_object&&this.state.app_object.disable_save||this.state.is_new_instance&&this.state.workflow_states; //workflow-enabled entities must declare a constructor.
var close_button=React.createElement("button",{onClick:this.handle_close,className:"btn btn-close"},'X');var form_buttons=[];if(this.state.is_new_instance){if(!caption||caption.trim()==""){caption=app_object_name;}else {caption=R.label_new+" "+caption;}if(this.state.workflow_states){for(var status in this.state.workflow_states){var workflow_state=this.state.workflow_states[status];if(workflow_state.constructors){for(var workflow_constructor_key in workflow_state.constructors){var workflow_constructor=workflow_state.constructors[workflow_constructor_key];skip_save=true;workflow_constructor.name=workflow_constructor_key;form_buttons.push(React.createElement("button",{disabled:this.state.areButtonsDisabled,onClick:this.handle_workflow_action_click.bind(this,workflow_constructor,status),key:"QK-form-buttons-workflow-"+workflow_constructor_key,className:"btn btn-primary shiny workflow_button_margin"},workflow_constructor.button_caption));}}}}}else {if(this.state.workflow_states){var entity_instance_status=this.state.entity_instance.workflow_status;if(entity_instance_status){for(var status in this.state.workflow_states){var workflow_state=this.state.workflow_states[status];if(status==entity_instance_status){workflow_status=workflow_state.caption;for(var workflow_action_status in workflow_state.workflow_actions){var workflow_action=workflow_state.workflow_actions[workflow_action_status];if(workflow_action.button_caption){form_buttons.push(React.createElement("button",{disabled:this.state.areButtonsDisabled,onClick:this.handle_workflow_action_click.bind(this,workflow_action,workflow_action_status),key:"QK-form-buttons-workflow-action-"+workflow_action.button_caption,className:"btn btn-primary shiny workflow_button_margin"},workflow_action.button_caption));}}break;}}}}if(!(this.form_is_read_only()||this.state.app_object&&this.state.app_object.custom_properties&&this.state.app_object.custom_properties.disable_delete)){form_buttons.push(React.createElement("button",{onClick:this.handle_delete,disabled:this.state.areButtonsDisabled,key:"QK-form-buttons-delete",className:"btn btn-danger shiny workflow_button_margin"},R.label_delete));}}if(!skip_save){if(this.props.data&&this.props.data.parent_react_entity){form_buttons.unshift(React.createElement("button",{onClick:this.handle_submit,disabled:this.state.areButtonsDisabled,className:"btn btn-success shiny workflow_button_margin",key:"QK-form-buttons-save"},R.label_save));}else {form_buttons.unshift(React.createElement("button",{type:"submit",disabled:this.state.areButtonsDisabled,className:"btn btn-success shiny workflow_button_margin",key:"QK-form-buttons-save"},R.label_save));}}if(workflow_status&&workflow_status.trim()!=""){workflow_status="("+workflow_status+")";}var cancel_button=React.createElement("button",{onClick:this.handle_close,className:"btn btn-default shiny",disabled:this.state.areButtonsDisabled,key:"QK-form-buttons-cancel"},R.label_cancel);form_buttons.push(cancel_button);if(this.state.workflow_states){workflow_comment_popup=React.createElement("div",{id:"workflow_comment_popup"},React.createElement("textarea",{id:"workflow_comment_text",rows:"10",cols:"42",placeholder:"Please enter comment..."}),React.createElement("br",null),React.createElement("button",{id:"workflow_comment_popup_submit",className:"btn btn-success shiny workflow_button_margin"},R.label_save),React.createElement("button",{id:"workflow_comment_popup_cancel",className:"btn btn-primary shiny workflow_button_margin"},R.label_cancel));}var app_object_desc=(this.state.app_object?this.state.app_object.description:"")||"";if(app_object_desc.length>0){app_object_desc=React.createElement("div",null,app_object_desc);}var uploadFileModal=null;if(this.state.uploadFileModal){uploadFileModal=React.createElement(EditorFileUploadModel,{file:this.state.fileToUpload,fileId:this.state.entity_instance._id,onUploadEnd:this.on_file_upload_end.bind(this,attribute),onUploadCancel:this.on_file_upload_cancel.bind(this,attribute)});}return React.createElement("div",{className:"widget"},uploadFileModal,React.createElement("div",{className:"widget-header bordered-bottom bordered-palegreen"},React.createElement("div",{className:"col-sm-6 widget-caption"},React.createElement("span",{className:"widget-caption"},React.createElement("b",null,caption||app_object_name||" ")," ",React.createElement("span",{className:"status-caption"},workflow_status))),React.createElement("div",{className:"col-sm-6 widget-caption",style:{"textAlign":"right","paddingRight":"0px"}}),React.createElement("div",{className:"widget-buttons"},React.createElement("span",{className:"widget-caption"},close_button))),React.createElement("div",{className:"widget-body"},React.createElement("div",null,error_component,React.createElement("div",null,app_object_desc),React.createElement("hr",{className:"wide"}),edit_form,React.createElement("form",{id:"edit_form",className:"form-horizontal form-bordered",role:"form",onSubmit:this.handle_submit},input_array,React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-12",style:{"textAlign":"right","paddingRight":"20px"}},form_buttons))),workflow_comment_popup)));}});var ErrorNotificationComponent=React.createClass({displayName:"ErrorNotificationComponent",render:function(){return React.createElement("div",{className:"alert alert-danger fade in"},React.createElement("button",{type:"button",className:"close",onClick:this.props.on_close},""),this.props.message);}});var ForgotPasswordComponent=React.createClass({displayName:"ForgotPasswordComponent",getInitialState:function(){return {error:undefined,disable_submit:true};},handle_submit:function(event){event.preventDefault();var request={};request.secret_answer=this.state.secret_answer;if(this.state.username.indexOf("@")==-1){request.login_name=this.state.username;}else {request.email_address=this.state.username;}var context=this;$.post("/api/auth/reset_password",request,function(data){if(data){if(data.success){context.props.on_complete();Notify(R.message_forgot_pass_email,'bottom-right',20000,'green','fa-check',true);}else {context.setState({error:data.message});}console.log(data);}}).fail(function(error){error=error.responseJSON;console.log(error);context.setState({error:error.message});});},on_username_change:function(event){this.setState({username:event.target.value});},on_username_blur:function(event){var lookup={};if(this.state.username.indexOf("@")==-1){lookup.login_name=this.state.username;}else {lookup.email_address=this.state.username;}var context=this;do_authenticated_http_call({url:"/api/auth/get_secret_question",method:"POST",data:lookup,success:function(data){console.log(data);if(data.success&&data.secret_question){context.setState({secret_question:data.secret_question,disable_submit:false});}else {context.setState({secret_question:undefined});}},error:function(error){var response=error.responseJSON;context.setState({error:response.message});}});},on_answer_change:function(event){this.setState({secret_answer:event.target.value});},componentWillUnmount:function(){document.body.className="";},render:function(){document.body.className="register-body";var error_component="";if(this.state.error){var on_close=(function(context){return function(){context.setState({error:undefined});};})(this);error_component=React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:on_close});}var secret_question="";if(this.state.secret_question){secret_question=React.createElement("div",{className:"registerbox-textbox"},React.createElement("p",null,React.createElement("b",null,R.label_secret_question,":")," ",this.state.secret_question),React.createElement("input",{type:"password",className:"form-control",placeholder:R.label_secret_answer,onChange:this.on_answer_change}));}return React.createElement("div",{className:"register-container animated fadeInDown"},React.createElement("table",{className:"registerbox"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null),React.createElement("td",null,React.createElement("div",{className:"registerbox-header01"},React.createElement("div",{className:"registerbox-header02"},React.createElement("div",{style:{"textAlign":"center"}},React.createElement("img",{src:"images/logo.png",alt:""}))))),React.createElement("td",null)),React.createElement("tr",null,React.createElement("td",{className:"registerbox-menu-border-ribbon"}),React.createElement("td",null,React.createElement("div",{className:"registerbox-menu_right"},React.createElement("div",{className:"registerbox-loggedout_right"},R.label_reset_password))),React.createElement("td",{className:"registerbox-menu-border-ribbon"})),React.createElement("tr",null,React.createElement("td",{className:"registerbox-menu-left-ribbon"}),React.createElement("td",null,React.createElement("div",{style:{"position":"relative"}},React.createElement("div",{className:"registerbox-ribbon-shadow"}),React.createElement("div",{className:"registerbox-content01"},React.createElement("div",{className:"registerbox-content02"},React.createElement("form",{className:"bv-form",onSubmit:this.handle_submit},error_component,R.label_fill_in_info,React.createElement("br",null),React.createElement("br",null),React.createElement("div",{className:"registerbox-textbox"},React.createElement("input",{id:"username",type:"text",className:"form-control","data-bv-notempty":"true","data-bv-notempty-message":"Hh",placeholder:R.placeholder_username,onChange:this.on_username_change,onBlur:this.on_username_blur})),secret_question,React.createElement("div",{className:"registerbox-submit"},React.createElement("input",{type:"submit",className:"btn btn-primary btn-block",value:R.label_submit}))))))),React.createElement("td",{className:"registerbox-menu-right-ribbon"})))));}});var HomeDashboardComponent=React.createClass({displayName:"HomeDashboardComponent",getInitialState:function(){this.initialize_dashboard();return {components:{}};},get_component_by_div_id:function(div_id){for(var key in this.state.components){var component=this.state.components[key];if(component.div_id&&component.div_id==div_id){return component;}}},get_dashboard_part_loc:function(dashboard_part_id){for(var i=0;i<this.state.home_layout.length;i++){var home_layout=this.state.home_layout[i];if(home_layout.dashboard_part_id==dashboard_part_id){return home_layout;}}},componentDidUpdate:function(){if(Object.keys(this.state.components).length==0||!this.state.home_layout||this.state.gridstack){return;}var context=this;var update_home_layout=function(){if(context.state.gridstack){var arr=[];$('.grid-stack-item').each(function(){var node=$(this).data('_gridstack_node');if(node==null){return;}var dx_id=this.children[0].children[0].getAttribute('id');if(dx_id){var component=context.get_component_by_div_id(dx_id);if(component==null){return;}var dashboard_part_id=component.dashboard_part._id;arr.push({dashboard_part_id:dashboard_part_id,x:node.x,y:node.y,width:node.width,height:node.height});}});invoke_method("user","update_home_layout",arr);}};var options={animate:true,float:true,width:12,cell_height:80,vertical_margin:10};var gridstack=$("#home_grid").gridstack(options).data('gridstack');$('#home_grid').on('dragstop',function(event,ui){update_home_layout();});$('#home_grid').on('resizestop',function(event,ui){var dx_id=ui.element[0].children[0].children[0].getAttribute('id');if(dx_id){var component=context.get_component_by_div_id(dx_id);if(component&&component.visual_control&&component.visual_control.render){component.visual_control.render({force:true,animated:false});}}update_home_layout();});for(var key in this.state.components){var component=this.state.components[key];var dp_width=component.dashboard_part.width;var dp_height=component.dashboard_part.height;var dp_x=component.row_number;var dp_y=component.col_number;var dp_loc=this.get_dashboard_part_loc(component.dashboard_part._id);if(dp_loc){dp_width=dp_loc.width;dp_height=dp_loc.height;dp_x=dp_loc.x;dp_y=dp_loc.y;}if(typeof dp_x!='undefined'&&typeof dp_y!='undefined'){gridstack.add_widget('<div class="widget no-header dashboard-part"><div class="grid-stack-item-content widget-body"><div id="'+component.div_id+'"></div></div></div>',dp_x,dp_y,dp_width,dp_height,false);}else {gridstack.add_widget('<div class="widget no-header dashboard-part"><div class="grid-stack-item-content widget-body"><div id="'+component.div_id+'"></div></div></div>',0,0,dp_width,dp_height,true);}var jquery_element=$("#"+component.div_id);var type=component.dashboard_part.visualization_type;var aggregation_data=component.dashboard_part.aggregation_data;if(aggregation_data&&Array.isArray(aggregation_data)&&aggregation_data.length>0){ /*Auto translate everything that is translatable*/for(var i=0;i<aggregation_data.length;i++){var value_field=component.dashboard_part.custom_properties.valueField;var data=aggregation_data[i][value_field];if(typeof data==="string"&&R[data]){data=R[data];}var argument_field=component.dashboard_part.custom_properties.argumentField;if(typeof aggregation_data[i][argument_field]==="string"&&R[aggregation_data[i][argument_field]]){aggregation_data[i][argument_field]=R[aggregation_data[i][argument_field]];}} /*End of auto translate*/switch(type){case "pie_chart":var properties={};properties.dataSource=aggregation_data;properties.title=component.dashboard_part.caption;properties.legend={visible:false};properties.animation={enabled:true};properties.resolveLabelOverlapping="shift";properties.series=[{argumentField:component.dashboard_part.custom_properties.argumentField,valueField:component.dashboard_part.custom_properties.valueField,label:{visible:true,customizeText:function(arg){return arg.argumentText+" ("+arg.valueText+")";}}}];if(component.dashboard_part.linked_app_object_code){properties.onPointClick=function(event){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);};}jquery_element.dxPieChart(properties);component.visual_control=jquery_element.dxPieChart("instance");break;case "line_chart":var properties={};properties.dataSource=aggregation_data;properties.title=component.dashboard_part.caption;properties.legend={verticalAlignment:"bottom",horizontalAlignment:"center",itemTextPosition:"bottom"};properties.animation={enabled:true};properties.resolveLabelOverlapping="shift";properties.commonSeriesSettings={argumentField:component.dashboard_part.custom_properties.argumentField,type:"line"};properties.series=[{valueField:component.dashboard_part.custom_properties.valueField,name:component.dashboard_part.custom_properties.name_caption}];if(component.dashboard_part.linked_app_object_code){properties.onPointClick=function(event){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);};}jquery_element.dxChart(properties);component.visual_control=jquery_element.dxChart("instance");break;case "bar_chart":var properties={};properties.dataSource=aggregation_data;properties.title=component.dashboard_part.caption;properties.animation={enabled:true};properties.series=[{argumentField:component.dashboard_part.custom_properties.argumentField,valueField:component.dashboard_part.custom_properties.valueField,name:component.dashboard_part.custom_properties.name_caption,type:"bar",color:component.dashboard_part.custom_properties.color}];if(component.dashboard_part.linked_app_object_code){properties.onPointClick=function(event){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);};}jquery_element.dxChart(properties);component.visual_control=jquery_element.dxChart("instance");break;case "ranked_list":var value_field=component.dashboard_part.custom_properties.valueField;var argument_field=component.dashboard_part.custom_properties.argumentField;var ol='<ol class="dashboard-ranked-list-ol">';for(var i=0;i<aggregation_data.length;i++){var data_point=aggregation_data[i][value_field];var argument_name=aggregation_data[i][argument_field];ol+='<li>'+data_point+' - '+argument_name+'</li>';}ol+='</ol>';var tile_html="<div>";tile_html+="<span class='dashboard-part-tile-title' title='"+component.dashboard_part.custom_properties.name_caption+"'>"+component.dashboard_part.custom_properties.name_caption+"</span>";tile_html+="<div class='bg-white no-padding'>";tile_html+=ol;tile_html+="</div></div>";jquery_element.html(tile_html);if(component.dashboard_part.linked_app_object_code){$("#"+component.div_id+" .dashboard-part-tile-body").click(function(e){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);});}break;case "tile":var value_field=component.dashboard_part.custom_properties.valueField;var data_point=aggregation_data[0][value_field];var argument_field=component.dashboard_part.custom_properties.argumentField;var argument_name=aggregation_data[0][argument_field];var data_point_color;if(component.dashboard_part.custom_properties&&component.dashboard_part.custom_properties.data_point_color){data_point_color=component.dashboard_part.custom_properties.data_point_color;}else {data_point_color="black";}var fontSize=4;if(data_point.toString().length<=6){fontSize=12-data_point.toString().length;}else if(data_point.toString().length<=8){fontSize=6;}else if(data_point.toString().length<=10){fontSize=5;}var tile_html="<div class=''>";tile_html+="<div>";tile_html+="<span class='dashboard-part-tile-title' title='"+argument_name+"'>"+argument_name+"</span>";tile_html+="<div class='bg-white no-padding'>";tile_html+="<h1 style='color:"+data_point_color+";font-size: "+fontSize+"vw' class='dashboard-part-tile-body'>"+data_point+"</h1>";tile_html+="</div></div></div>";jquery_element.html(tile_html);if(component.dashboard_part.linked_app_object_code){$("#"+component.div_id+" .dashboard-part-tile-body").click(function(e){var app_object={};app_object.type="data_list";app_object.code=component.dashboard_part.linked_app_object_code;return context.props.app_object_handler(app_object);});}console.log(tile_html);break;default:break;}}}this.state.gridstack=gridstack;},initialize_dashboard:function(){var context=this;var get_dashboard_parts=function(){var success=function(data){var components={};for(var i=0;data.app_object&&data.app_object.dashboard_parts&&i<data.app_object.dashboard_parts.length;i++){var dashboard_part=data.app_object.dashboard_parts[i];var div_id=makeid();components[dashboard_part._id]={};components[dashboard_part._id].div_id=div_id;components[dashboard_part._id].dashboard_part=dashboard_part;}context.setState({app_object:data.app_object,components:components});push_href_location(data.app_object.name+" - "+(R.client_application_title||"Xenforma"),"/");};var error=function(err){context.setState({error:err.message});};get_app_object("home",{},success,error);};var get_home_layout=function(){var success=function(data){data=data.data;context.setState({home_layout:data});};var error=function(err){context.setState({error:err.message});};invoke_method("user","get_home_layout",{},success,error);};get_dashboard_parts();get_home_layout();},render:function(){var error_component="";if(this.state.error){error_component=React.createElement("div",null,React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:this.on_error_close}),React.createElement("br",null));}return React.createElement("div",{className:"form-group"},error_component,React.createElement("div",{id:"home_grid",className:"grid-stack"}));}});var LoadingComponent=React.createClass({displayName:"LoadingComponent",render:function(){return React.createElement("div",{className:"loading-container"},React.createElement("div",{className:"loader"}));}});var LockComponent=React.createClass({displayName:"LockComponent",getInitialState:function(){return {};},handle_submit:function(event){event.preventDefault();if(this.state.logging_in){return;}this.setState({logging_in:true});var login_name=this.props.user_info.login_name;if(!login_name){login_name=this.props.user_info.email_address;}var credentials=login_name+":"+this.state.password;credentials=window.btoa(credentials);var context=this;do_authenticated_http_call({method:"POST",url:"/api/auth/login",headers:{Authorization:"Basic "+credentials},success:function(data){if(context.state.error){context.setState({error:undefined});}context.setState({success:true});console.log(data);context.props.on_success();},error:function(error){if(error.responseJSON){return context.setState({error:error.responseJSON});}},complete:function(){if(!context.state.success){context.setState({logging_in:false});}}});},on_password_change:function(event){this.setState({password:event.target.value});},render:function(){var error_component="";if(this.state.error){error_component=React.createElement(ErrorNotificationComponent,{message:this.state.error.message});}return React.createElement("div",{className:"lock-container animated fadeInDown"},React.createElement("div",{className:"lock-box text-align-center"},React.createElement("div",{className:"lock-username"},this.props.user_info.first_name+" "+this.props.user_info.last_name),React.createElement("img",{src:this.props.user_avatar,alt:this.props.user_info.first_name+" "+this.props.user_info.last_name}),React.createElement("div",{className:"lock-password"},error_component,React.createElement("form",{role:"form",className:"form-inline",onSubmit:this.handle_submit},React.createElement("div",{className:"form-group"},React.createElement("span",{className:"input-icon icon-right"},React.createElement("input",{className:"form-control",placeholder:R.placeholder_password,type:"password",onChange:this.on_password_change}),React.createElement("i",{className:"glyphicon glyphicon-log-in themeprimary"})),React.createElement("input",{hidden:true,type:"submit"}))))));}});var LoginComponent=React.createClass({displayName:"LoginComponent",getInitialState:function(){return {logging_in:false,username:"",password:"",success:false};},handle_login:function(event){event.preventDefault();if(!this.state.logging_in){ // Validate login information here
this.setState({logging_in:true});var credentials=this.state.username+":"+this.state.password;credentials=window.btoa(credentials);var component_class=this;$.ajax({method:"POST",url:"/api/auth/login", //timeout: 5000,
headers:{Authorization:"Basic "+credentials},success:function(data){if(component_class.state.error){component_class.setState({error:undefined});}var login_token=data.login_token;if(login_token!==undefined){localStorage.setItem("login_token",login_token);g_login_token=login_token;component_class.setState({success:true});component_class.props.on_success();}else { // we did not receive a login_token
}},error:function(error){if(error.responseJSON){return component_class.setState({error:error.responseJSON.message});}return component_class.setState({error:error.statusText});},complete:function(){if(!component_class.state.success){component_class.setState({logging_in:false});}}});}},handle_forgot_password:function(event){event.preventDefault();this.props.on_success(true);},username_changed:function(event){this.setState({username:event.target.value});},password_changed:function(event){this.setState({password:event.target.value});},componentWillUnmount:function(){document.body.className="";},render:function(){document.body.className="login-body";if(this.state.logging_in){return React.createElement(LoadingComponent,null);}else {var error_component="";if(this.state.error){var on_close=(function(context){return function(){context.setState({error:undefined});};})(this);error_component=React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:on_close});}return React.createElement("div",{className:"login-container animated fadeInDown"},React.createElement("table",{className:"loginbox"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null),React.createElement("td",null,React.createElement("div",{className:"loginbox-header01"},React.createElement("div",{className:"loginbox-header02"},React.createElement("div",{style:{"textAlign":"center"}},React.createElement("img",{src:"images/logo.png",alt:""}))))),React.createElement("td",null)),React.createElement("tr",null,React.createElement("td",{className:"loginbox-menu-border-ribbon"}),React.createElement("td",null,React.createElement("div",{className:"loginbox-menu_right"},React.createElement("div",{className:"loginbox-loggedout_right"},React.createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAeCAYAAAAy2w7YAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABCJJREFUeNq8Vm9oG2UYf++uae7SXHJJbk1Su/RqJ02b1qZbF4ubuI2Nsm6IboKIWIdMhIoydIIf/CCICCI4FPwgAzdQtg8FJ34QP7gvc+qgH1a6oQzrWiYhpbHJ5XZ3+R+f58zVozO5q4oP/Li79973/T3v8/ye547a8eJHxMYCgD2AEYDQHMsDFgFXm/e21tHmHQU4BDjcK7CB6UR3YrhHkHjW1YUvlWJF/SktL/14e/3MQlq5+G+InqAocuDEQ9t3Tj0YSwl+H+PxeEhHx59LqtUqF5c0cX+i8Nn8Umb6/W+XZv4J0TjgwCv7B/ZOje8YCwaDBElcLhehadqYUK/XSaVSIYIgMD7e+2xPwNN4dW7xuVZEdIuxx6dHwgPTE4NjkUiE+P1+wjDM18ViMVUoFGjEXVWbXCvoC/gO5wz3986cm9l5bCsnkhiaEp/ZE384FAoRjuNIqVT6MJ/Pn9r39hcNy7xrSWnbxOzhXVcfSUgpURSJphc/OPv06KWTFxbrTk7Uv7svEIlFt/kwXBCeW9ls9vQmEsOuL69VXz9/+Z3VXEHGuWIoGAPHUk5Dx4/1iWFcSIEaFEX5/OC7X1VahUTWyquXry/dwrm4BogmHecoxHs8qC5QFlFV9baNcmvLqzkZ56JY3G531CkRSJhGI7VaDUNXtauRUqVaRxXiGnDQ5ZiIMmqVbMjYzhqNhgFjLUW1VR0H6Gteu62TF+6sS826amWS9SEj691wiQNWALqVCPvXaT/XER6N8t1CF+uOCF0CkiHKtcZTRxLhR2stTsZAuOI9Qticr5Vre4+ORs+oxdLvPjfzxpc31u4YJ4Wm+th9AnvsraOJ46LAe7FuoNqNIsWw5XI5AgVq5OtviRiG+Hw+EggEjBzJskyg5oiu6ySvqNlqSR974eKNNJ7I/+Su2MgD/TEvz/NGL0P14Aa4EEm9Xu9GDu7JJ5wC1yDwHknRWVRhQFHETCYzC9PeNHIUDfm7cEOzdqybgFwNODV0EoGOobOapvVuqM7qkZ26IJw/q8XySqsTbj5pZ2fnX/I2E9m2KiFH4N2JwdmPh5KnPpHOfjM/1ypvVjJzX9pJONB76Nzzydc+PW+OvXfp2ne/prNrdidrW7CbDdWXzRWs+h4GDOSVuxUnBe2YCI11MRMXTk5ONR8nDw6F+7eHvFGn6x0Rocw5jqVBlc+bDeDQSG/cw3GU+cX9T4gwoagelmVvmkRZrbqOY3Yi2nLoMOnpnPob3IrY31aySs6pEOz+gu4h+mVVfvn+kGcfPg9G/OGtEjmSDVb51PhAMiUFk8ZfJfQ2HNsK0XK9bu8athXcHPuetdU4sJpJ9ENBL1+BehiyUx6IwYBTwxoDfL8Rut19wkvwS1UGD4/Dhs53ak9ShD3n4HNxzvwekf/D/hBgAByBgt7jg8aYAAAAAElFTkSuQmCC"}),"",R.login_to_your_account))),React.createElement("td",{className:"loginbox-menu-border-ribbon"})),React.createElement("tr",null,React.createElement("td",{className:"loginbox-menu-left-ribbon"}),React.createElement("td",null,React.createElement("div",{style:{"position":"relative"}},React.createElement("div",{className:"loginbox-ribbon-shadow"}),React.createElement("div",{className:"loginbox-content01"},React.createElement("div",{className:"loginbox-content02"},React.createElement("form",{id:"login_form",className:"bv-form",onSubmit:this.handle_login},error_component,React.createElement("div",{className:"loginbox-textbox"},React.createElement("input",{type:"text",className:"form-control",placeholder:R.placeholder_username,onChange:this.username_changed,"data-bv-notempty":"true","data-bv-regexp":"true","data-bv-regexp-message":R.the_username_can_only_consist_of_alphabetical_number_dot_and_underscore,"data-bv-regexp-regexp":"(^[a-zA-Z0-9_\\.]+$)|(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])"})),React.createElement("div",{className:"loginbox-textbox"},React.createElement("input",{type:"password",className:"form-control",placeholder:R.placeholder_password,onChange:this.password_changed})),React.createElement("div",{className:"loginbox-submit"},React.createElement("input",{type:"submit",className:"btn btn-primary btn-block",value:R.label_login})),React.createElement("div",{className:"loginbox-forgot"},R_loc.help_i,"",React.createElement("a",{href:"",onClick:this.handle_forgot_password},R.label_forgot_password))))))),React.createElement("td",{className:"loginbox-menu-right-ribbon"})))));}}});var MainComponent=React.createClass({displayName:"MainComponent",measure_idle_time:function(){var context=this; //TODO: Lock disabled until it's fixed
/*clearInterval(context.state.idle_interval);

         idle_interval = setInterval(function() {
         idle_time += 1;
         if (idle_time > 600) {
         context.setState({locked:true});
         clearInterval(context.state.idle_interval);
         context.logout();
         }
         }, 1000);

         this.state.idle_interval = idle_interval;

         $(document).ready(function() {
         $(this).mousemove(function (e) {
         idle_time = 0;
         });

         $(this).keypress(function (e) {
         idle_time = 0;
         });
         });*/},get_user_info:function(){var request={};request.entity="user";request.method="get_info";var context=this;do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",dataType:'json',data:request,success:function(data){context.setState({user_info:data.data});},error:function(error){if(error.responseJSON){context.setState({error:error.responseJSON});}},complete:function(){}});},get_user_avatar:function(){var request={};request.entity="user";request.method="get_avatar";var context=this;do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",dataType:'json',data:request,error:function(error){if(error.responseJSON){context.setState({error:error.responseJSON});}context.setState({user_avatar:error.responseText});},complete:function(){console.log("get_user_avatar completed");}}).done(function(data){context.setState({user_avatar:data});});},logout:function(){localStorage.removeItem("login_token");this.on_logged_off_handler();},initialize_state:function(){var context=this;return is_logged_in(function(logged_in,data){if(logged_in){context.on_login_handler();}else {context.on_logged_off_handler();}context.setState({startup_loading:false});});},on_login_handler:function(){var context=this;this.setState({logged_in:true});load_translations(false,function(){context.forceUpdate();});this.initialize_user();this.handle_logged_in_locations();window.onpopstate=function(event){g_popped=true;context.handle_logged_in_locations();};},on_logged_off_handler:function(){var context=this;this.setState({logged_in:false});load_translations(true,function(){context.forceUpdate();});this.handle_locations();var context=this;window.onpopstate=function(event){g_popped=true;context.handle_locations();};},initialize_user:function(){this.measure_idle_time();this.get_user_info();this.get_user_avatar();},getInitialState:function(){var context=this;setTimeout(function(){context.initialize_state();},1);return {startup_loading:true,isCompact:false};},menu_click:function(isCompact){this.setState({isCompact:isCompact});},handle_logged_in_locations:function(){var state_object=get_clear_state();if(window.location.pathname=="/"){state_object.home=true;}else if(window.location.pathname=="/settings"){state_object.settings=true;}else if(window.location.pathname=="/edit_form"){if(get_parameter_by_name("code")){state_object.edit_form=true;state_object.app_object_code=get_parameter_by_name("code");state_object.edit_form_id=get_parameter_by_name("_id");}}else if(window.location.pathname=="/data_list"){if(get_parameter_by_name("code")){state_object.data_list=true;state_object.app_object_code=get_parameter_by_name("code");}}else if(window.location.pathname=="/dashboard"){if(get_parameter_by_name("code")){state_object.dashboard=true;state_object.app_object_code=get_parameter_by_name("code");}}else if(window.location.pathname=="/search"){if(get_parameter_by_name("search_string")){state_object.search=true;state_object.search_string=get_parameter_by_name("search_string");}}else if(window.location.pathname=="/user_list"){ //this.navigation_handler("user_data_list");
state_object.user_data_list=true;}this.setState(state_object);},handle_locations:function(){var state_object=get_clear_state();if(window.location.pathname=="/setup_user"){state_object.setup_user=true;var setup_token=get_parameter_by_name("setup_token");if(setup_token!=""){state_object.setup_token=setup_token;}}else if(window.location.pathname=="/reset_password"){state_object.reset_password=true;var reset_password_token=get_parameter_by_name("reset_password_token");if(reset_password_token!=""){state_object.reset_password_token=reset_password_token;}}this.setState(state_object);},handle_login_success:function(forgot_password){if(!forgot_password){this.on_login_handler();}else {this.setState({forgot_password:true});}},handle_forgot_password_completion:function(){this.setState({forgot_password:false});},handle_setup_user_success:function(){var interval=setInterval(function(){clearInterval(interval);window.location.href=window.location.protocol+"//"+window.location.host;},1000);},handle_reset_password_completion:function(){this.setState({reset_password:false});},navigation_handler:function(location){var context=this;var handle_navigation=function(){if(location=="home"){var state_object=get_clear_state();state_object.home=true;context.setState(state_object);}else if(location=="settings"){var state_object=get_clear_state();state_object.settings=true;context.setState(state_object);}else if(location=="invite_users"){var state_object=get_clear_state();state_object.invite_users=true;context.setState(state_object);}else if(location=="user_data_list"){var state_object=get_clear_state();state_object.user_data_list=true;context.setState(state_object);}else if(location=="logout"){context.on_logged_off_handler();}};if(current_navigation_listener){return current_navigation_listener(function(confirm_location_change){if(confirm_location_change){handle_navigation();}});}else {handle_navigation();}},app_object_handler:function(app_object){var context=this;var handle_app_object=function(){var state_object=get_clear_state();var code=app_object.code;var data_list=app_object.type=="data_list";var edit_form=app_object.type=="edit_form";var dashboard=app_object.type=="dashboard";var conditions=$.extend({},app_object.conditions||{});delete state_object.app_object_conditions;if(app_object.workflow_conditions){conditions.workflow_status=app_object.workflow_conditions.workflow_status; //overrides standing conditions.
}state_object.data_list=data_list;state_object.edit_form=edit_form;state_object.dashboard=dashboard;state_object.app_object_code=code;if(data_list){state_object.app_object_conditions=conditions;}state_object.edit_form_id=app_object._id;context.setState(state_object);};if(current_navigation_listener){return current_navigation_listener(function(confirm_location_change){if(confirm_location_change){handle_app_object();}});}else {return handle_app_object();}},search_handler:function(search_string){var state_object=get_clear_state();state_object.search=true;state_object.search_string=search_string;this.setState(state_object);},render:function(){if(this.state.startup_loading){return React.createElement(LoadingComponent,null);}if(this.state.logged_in){var page_content="";if(this.state.home){page_content=React.createElement(HomeDashboardComponent,{key:"home",app_object_handler:this.app_object_handler});}else if(this.state.settings){page_content=React.createElement(UserSettingsComponent,{update_avatar:this.get_user_avatar,update_user_info:this.get_user_info,avatar:this.state.user_avatar});}else if(this.state.invite_users){page_content=React.createElement(InviteUsersComponent,null);}else if(this.state.edit_form){page_content=React.createElement(EditFormComponent,{app_object_code:this.state.app_object_code,data:this.state.data,navigation_handler:this.navigation_handler,_id:this.state.edit_form_id,key:this.state.app_object_code+this.state.edit_form_id,app_object_handler:this.app_object_handler,update_avatar:this.get_user_avatar,update_user_info:this.get_user_info});}else if(this.state.data_list){var key=this.state.app_object_code;if(this.state.app_object_conditions){key+=":"+JSON.stringify(this.state.app_object_conditions);}page_content=React.createElement(DataListComponent,{app_object_code:this.state.app_object_code,key:key,app_object_handler:this.app_object_handler,navigation_handler:this.navigation_handler,conditions:this.state.app_object_conditions});}else if(this.state.dashboard){page_content=React.createElement(DashboardComponent,{app_object_code:this.state.app_object_code,key:this.state.app_object_code,app_object_handler:this.app_object_handler});}else if(this.state.search){page_content=React.createElement(SearchComponent,{search_string:this.state.search_string,key:this.state.search_string,app_object_handler:this.app_object_handler});}else if(this.state.user_data_list){page_content=React.createElement(UserListComponent,{key:"user_data_list",app_object_handler:this.app_object_handler});}return React.createElement("div",null,React.createElement(NavBarComponent,{navigation_handler:this.navigation_handler,user_info:this.state.user_info,user_avatar:this.state.user_avatar,menu_click:this.menu_click}),React.createElement("div",{className:"main-container container-fluid"},React.createElement("div",{className:"page-container"},React.createElement(SideBarComponent,{navigation_handler:this.navigation_handler,app_object_handler:this.app_object_handler,search_handler:this.search_handler,isCompact:this.state.isCompact}),React.createElement("div",{className:"page-content"},React.createElement("div",{className:"page-body"},page_content)))));}if(this.state.forgot_password){return React.createElement(ForgotPasswordComponent,{on_complete:this.handle_forgot_password_completion});}else if(this.state.reset_password){return React.createElement(ResetPasswordComponent,{on_complete:this.handle_reset_password_completion});}else if(this.state.setup_user){return React.createElement(SetupUserComponent,{on_success:this.handle_setup_user_success});}else if(this.state.locked){return React.createElement(LockComponent,{user_info:this.state.user_info,user_avatar:this.state.user_avatar,on_success:this.handle_login_success});}else {return React.createElement(LoginComponent,{on_success:this.handle_login_success});}}});var NavBarComponent=React.createClass({displayName:"NavBarComponent",handle_setting_click:function(event){event.preventDefault();this.props.navigation_handler("settings");},handle_logout_click:function(event){event.preventDefault();this.props.navigation_handler("logout");},sidebar_click:function(){$(".sidebar-collapse").toggleClass("active");this.props.menu_click($(".sidebar-collapse").hasClass("active"));},render:function(){var first_name="";var last_name="";var email_address="";if(this.props.user_info){first_name=this.props.user_info.first_name;last_name=this.props.user_info.last_name;email_address=this.props.user_info.email_address;}console.log(this.props.user_avatar);var avatar="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAdCAYAAABbjRdIAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADdYAAA3WAZBveZwAAAAHdElNRQffCwwXAhldjvVEAAAAGHRFWHRTb2Z0d2FyZQBwYWludC5uZXQgNC4wLjVlhTJlAAAC3klEQVRIS81WS2sTURSu9Q2CoGAXIriqS3Xlxk3B/oP+AkFw4VJXInHlRnDlVlBQkOCyuHERsJA0Nn0lk0zmlZm5M3nMI6koCNrW63cvd2KSTnQmqeAHH3N655zvzLnn3JvO/NfI5egxYf47bCjOVdnynlW09stqo31jW3av5HK5w02claQTkt56pJHgh+6EFM+f4D64p9p+WG149yXJOyPcp4Pc6DxhCViicVRsv5CXyDkRMhkkxb0GMV7R36hY/kqJ0uMiND1ko/M2TngcJdVZEqHpUKy55zU76MaJjmPd9N+J8HTYxBaiV7txouNYt/ytbDZ7VEgkB0Z8gU1dnOg4KpansukVEskxmEwlAVXtgAtWtBaVTY/bGP3+OiP8DVVVTwqJZCiUjTkIWZHIhkxoqWZzG2eOk9mlqkXXa2Qw2S4O/AMhkwyyyasaOlv4mz9Xy41+NRr5vR5Rsb2GkEkGdr4gcqBftUaHrknW0Noo65b3UcgkQ4bSWfTlw6gQ61Fh26BFXp0/9E683y0r7i0hkxybCrmIhMsjYn2bbd/gFuLKMqt66y6l9IiQSIctvX0Bgl8jwWLFpGW1Sctak1eIBFHivYrmLIiwySEb7ccQ48OigZLR5tPIhiP6CNyLhanuxQj5PDmNpucj4VGqxO9tGe68cJ8equUtsX4N9ojZbA3JdkzTPCVcpwNruE6CV1ECbBnn0M3hdO8I98nBvhi9uQfB75FwLEkQsuqlNPciqpg1zZ3L2JrbEHmNgegcEP4DUbmpO/5To9m7afR6Z4XsQWhu9xKqWEaCb3FCacinlwQ+7OemSYf7abj+PBJ5o0GHw+BF/6BnMplZJHof7zg9UeW+0QwXeTLV9a8je6pf5LREwhVeneaGD+McDpOaE3w2Op25Gc3x32BhfYAlnYQlDMoa7E+ouoh/fIr4ulU0vTBEt8ueq8yHxcFnE3FltEWGbeCdAwbQ+6La4eIv5tjoJ5lkNqsAAAAASUVORK5CYII=";if(this.props.user_avatar){avatar=this.props.user_avatar;}return React.createElement("div",{className:"navbar"},React.createElement("div",{className:"navbar-inner"},React.createElement("div",{className:"navbar-container"},React.createElement("div",{className:"navbar-header pull-left"},React.createElement("a",{href:"#",className:"navbar-brand"},React.createElement("small",null,React.createElement("img",{src:"images/logo.png",alt:""})))),React.createElement("div",{className:"sidebar-collapse",id:"sidebar-collapse",onClick:this.sidebar_click},React.createElement("i",{className:"collapse-icon fa fa-bars"})),React.createElement("div",{className:"navbar-header pull-right"},React.createElement("div",{className:"navbar-account"},React.createElement("ul",{className:"account-area"},React.createElement("li",null,React.createElement("a",{className:"login-area dropdown-toggle","data-toggle":"dropdown"},React.createElement("div",{className:"avatar",title:"View your public profile"},React.createElement("img",{src:avatar}))),React.createElement("ul",{className:"pull-right dropdown-menu dropdown-arrow dropdown-login-area"},React.createElement("li",{className:"email"},React.createElement("span",{className:"menu-user-name"},first_name+" "+last_name),React.createElement("a",null,email_address)),React.createElement("li",{className:"dropdown-footer"},React.createElement("a",{href:"",className:"pull-left",onClick:this.handle_setting_click},"Settings"),React.createElement("a",{href:"",onClick:this.handle_logout_click},"Logout"))))))))));}});var ResetPasswordComponent=React.createClass({displayName:"ResetPasswordComponent",getInitialState:function(){return {reset_password_token:get_parameter_by_name("reset_password_token")};},handle_submit:function(event){event.preventDefault();if(this.state.password!=this.state.confirm_password){this.setState({error:R.message_passwords_dont_match});return;}var data={};data.reset_password_token=this.state.reset_password_token;data.password=this.state.password;var context=this;$.ajax({url:"/api/auth/reset_password_token",method:"POST",data:data,success:function(data){if(data.success){context.props.on_complete();Notify(R.message_successfully_reset_password,'bottom-right',20000,'green','fa-check',true);}},error:function(error){var response=error.responseJSON;console.log(response);context.setState({error:response.message});}});},on_password_change:function(event){this.setState({password:event.target.value});},on_confirm_password_change:function(event){this.setState({confirm_password:event.target.value});},on_error_close:function(){this.setState({error:undefined});},componentWillUnmount:function(){document.body.className="";},render:function(){document.body.className="register-body";var error_component="";if(this.state.error){error_component=React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:this.on_error_close});}return React.createElement("div",{className:"register-container animated fadeInDown"},React.createElement("table",{className:"registerbox"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null),React.createElement("td",null,React.createElement("div",{className:"registerbox-header01"},React.createElement("div",{className:"registerbox-header02"},React.createElement("div",{style:{"textAlign":"center"}},React.createElement("img",{src:"images/logo.png",alt:""}))))),React.createElement("td",null)),React.createElement("tr",null,React.createElement("td",{className:"registerbox-menu-border-ribbon"}),React.createElement("td",null,React.createElement("div",{className:"registerbox-menu_right"},React.createElement("div",{className:"registerbox-loggedout_right"},R.label_reset_password))),React.createElement("td",{className:"registerbox-menu-border-ribbon"})),React.createElement("tr",null,React.createElement("td",{className:"registerbox-menu-left-ribbon"}),React.createElement("td",null,React.createElement("div",{style:{"position":"relative"}},React.createElement("div",{className:"registerbox-ribbon-shadow"}),React.createElement("div",{className:"registerbox-content01"},React.createElement("div",{className:"registerbox-content02"},React.createElement("form",{className:"bv-form",onSubmit:this.handle_submit},error_component,R.label_fill_in_info,React.createElement("br",null),React.createElement("br",null),React.createElement("div",{className:"registerbox-textbox"},React.createElement("input",{type:"password",className:"form-control",placeholder:R.placeholder_password,onChange:this.on_password_change})),React.createElement("div",{className:"registerbox-textbox"},React.createElement("input",{type:"password",className:"form-control",placeholder:R.placeholder_confirm_password,onChange:this.on_confirm_password_change})),React.createElement("div",{className:"registerbox-submit"},React.createElement("input",{type:"submit",className:"btn btn-primary btn-block",value:R.label_submit}))))))),React.createElement("td",{className:"registerbox-menu-right-ribbon"})))));}});var SearchComponent=React.createClass({displayName:"SearchComponent",getInitialState:function(){this.initialize_search();return {};},initialize_search:function(){var search_string=this.props.search_string;var request={};request.data={search_string:search_string};var context=this;do_authenticated_http_call({method:"POST",url:"/api/entity/full_text_search",contentType:"application/json",dataType:'json',data:JSON.stringify(request),success:function(data){context.setState({search_results:data.data});console.log(data.data);push_href_location(search_string+" - "+(R.client_application_title||"Xenforma"),"/search?search_string="+search_string);},error:function(error){if(error.responseJSON){console.log(error.responseJSON);context.setState({error:error.responseJSON.message});}},complete:function(){}});},componentDidMount:function(){if(this.state.search_results){$('.highlightee').highlight(this.props.search_string);}},componentDidUpdate:function(){if(this.state.search_results){$('.highlightee').highlight(this.props.search_string);}},handle_search_result_click:function(search_result,event){event.preventDefault();if(search_result.entity_id){var app_object={};app_object.code=search_result.app_object_code;app_object.type="edit_form";app_object._id=search_result.entity_id;this.props.app_object_handler(app_object);}},render:function(){var columns=[];columns.push({dataField:"entity_name",caption:R.label_entity_name});columns.push({dataField:"caption",caption:R.label_caption});this.state.columns=columns;var input_elements=[];for(var i=0;this.state.search_results&&i<this.state.search_results.length;i++){var search_result=this.state.search_results[i];var descriptors=[];for(var j=0;j<search_result.descriptors.length;j++){ //var descriptor = <div><b>{search_result.descriptors[j].caption}</b>: <span className="highlightee">{search_result.descriptors[j].value}</span></div>;
var value=search_result.descriptors[j].value;if(typeof value=="undefined"){continue;}if(typeof search_result.descriptors[j].value=="object"){continue;}var descriptor=React.createElement("tr",null,React.createElement("td",null,React.createElement("b",null,search_result.descriptors[j].caption)),React.createElement("td",null,React.createElement("span",{className:"highlightee"},value)));descriptors.push(descriptor);}var descriptor_insert="";if(descriptors.length>0){descriptor_insert=React.createElement("table",{className:"table"},React.createElement("tbody",null,descriptors));}var caption=search_result.caption;if(!caption){caption=search_result.entity_id;}var input_element=React.createElement("div",{className:"widget no-header radius-bordered",style:{"overflow":"hidden"},key:caption},React.createElement("a",{href:"",onClick:this.handle_search_result_click.bind(this,search_result)},React.createElement("h4",null,React.createElement("b",null,caption))),React.createElement("div",null,React.createElement("div",{className:"col-sm-1"},React.createElement("img",{src:search_result.image})),React.createElement("div",{className:"col-sm-11"},descriptor_insert)));input_elements.push(input_element);}if(input_elements.length==0){input_elements=R.label_no_data;}return React.createElement("div",{className:"widget"},React.createElement("div",{className:"widget-header bordered-bottom bordered-palegreen"},React.createElement("span",{className:"widget-caption"},R.label_search_description)),React.createElement("div",{className:"widget-body"},input_elements));}});var SetupUserComponent=React.createClass({displayName:"SetupUserComponent",getInitialState:function(){this.get_secret_questions();return {error:undefined};},get_secret_questions:function(){var context=this;$.ajax({method:"GET",url:"/api/auth/get_secret_questions",success:function(data){context.setState({secret_questions:data});},error:function(err){console.log(err);}});},handle_submit:function(event){event.preventDefault();if(this.state.password!=this.state.confirmed_password){this.setState({error:R.message_passwords_dont_match});return;}var request={};request.setup_token=get_parameter_by_name("setup_token");request.username=this.state.username;request.password=this.state.password;request.email_address=this.state.email;request.secret_question=this.state.secret_question;request.secret_answer=this.state.secret_answer;this.setState({loading:true});var context=this;$.post("/api/auth/setup_user",request,function(data){if(data){if(data.success){context.setState({completed:true});Notify(R.message_successfully_registered,'bottom-right',20000,'green','fa-check',true);context.props.on_success();}else {context.setState({error:data.message});}console.log(data);}}).fail(function(error){error=error.responseJSON;console.log(error);context.setState({error:error.message});}).complete(function(){if(!context.state.completed){context.setState({loading:false});}});},on_username_change:function(event){this.setState({username:event.target.value});$("#username").bootstrapValidator();},on_password_change:function(event){this.setState({password:event.target.value});},on_confirmed_password_change:function(event){this.setState({confirmed_password:event.target.value});},on_email_change:function(event){this.setState({email:event.target.value});},on_secret_question_change:function(event){this.setState({secret_question:event.target.value});},on_secret_answer_change:function(event){this.setState({secret_answer:event.target.value});},componentWillUnmount:function(){document.body.className="";},render:function(){document.body.className="register-body";var error_component="";if(this.state.error){var on_close=(function(context){return function(){context.setState({error:undefined});};})(this);error_component=React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:on_close});}var secret_questions=[];if(this.state.secret_questions){for(var i=0;i<this.state.secret_questions.length;i++){var secret_question=this.state.secret_questions[i];secret_questions.push(React.createElement("option",{key:secret_question.code,value:secret_question.code},secret_question.value));}}var submit_button=React.createElement("input",{type:"submit",className:"btn btn-primary btn-block",value:R.label_submit});if(this.state.loading){submit_button=React.createElement("input",{type:"submit",disabled:true,className:"btn btn-primary btn-block",value:R.label_submit});}return React.createElement("div",{className:"register-container animated fadeInDown"},React.createElement("table",{className:"registerbox"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null),React.createElement("td",null,React.createElement("div",{className:"registerbox-header01"},React.createElement("div",{className:"registerbox-header02"},React.createElement("div",{style:{"textAlign":"center"}},React.createElement("img",{src:"images/logo.png",alt:""}))))),React.createElement("td",null)),React.createElement("tr",null,React.createElement("td",{className:"registerbox-menu-border-ribbon"}),React.createElement("td",null,React.createElement("div",{className:"registerbox-menu_right"},React.createElement("div",{className:"registerbox-loggedout_right"},R.label_register))),React.createElement("td",{className:"registerbox-menu-border-ribbon"})),React.createElement("tr",null,React.createElement("td",{className:"registerbox-menu-left-ribbon"}),React.createElement("td",null,React.createElement("div",{style:{"position":"relative"}},React.createElement("div",{className:"registerbox-ribbon-shadow"}),React.createElement("div",{className:"registerbox-content01"},React.createElement("div",{className:"registerbox-content02"},React.createElement("form",{className:"bv-form",onSubmit:this.handle_submit},error_component,R.label_fill_in_info,React.createElement("br",null),React.createElement("br",null),React.createElement("div",{className:"registerbox-textbox"},React.createElement("input",{id:"username",type:"text",className:"form-control",placeholder:R.placeholder_username,onChange:this.on_username_change})),React.createElement("div",{className:"registerbox-textbox"},React.createElement("input",{type:"text",className:"form-control",placeholder:R.placeholder_email_address,onChange:this.on_email_change})),React.createElement("div",{className:"registerbox-textbox"},React.createElement("input",{type:"password",className:"form-control",placeholder:R.placeholder_password,onChange:this.on_password_change})),React.createElement("div",{className:"registerbox-textbox"},React.createElement("input",{type:"password",className:"form-control",placeholder:R.placeholder_confirm_password,onChange:this.on_confirmed_password_change})),React.createElement("div",{className:"registerbox-textbox"},React.createElement("select",{className:"form-control",name:"country",defaultValue:"",onChange:this.on_secret_question_change},React.createElement("option",{disabled:true,key:"",value:""},R.select_secret_question),secret_questions)),React.createElement("div",{className:"registerbox-textbox"},React.createElement("input",{type:"password",className:"form-control",placeholder:R.placeholder_secret_answer,onChange:this.on_secret_answer_change})),React.createElement("div",{className:"registerbox-submit"},submit_button)))))),React.createElement("td",{className:"registerbox-menu-right-ribbon"})))));}});var SideBarSection=React.createClass({displayName:"SideBarSection",handleClick:function(event){event.preventDefault();if(this.props.isCompact==true)return;if(this.props.open){this.props.onOpen(false);}else {this.props.onOpen(true);}},render:function(){var styles={block:{display:"block"},none:{display:"none"}};var menuExpand="";if(this.props.isCompact==false){menuExpand=React.createElement("i",{className:"menu-expand"});}var liClass='';if(!this.props.isCompact&&this.props.open){liClass='open';}var iClassName="menu-icon fa "+this.props.icon;return React.createElement("li",{className:liClass},React.createElement("a",{href:"",className:"menu-dropdown",onClick:this.handleClick},React.createElement("i",{className:iClassName}),React.createElement("span",{className:"menu-text"}," ",this.props.title," "),menuExpand),React.createElement("ul",{className:"submenu",style:this.props.open==true?styles.block:styles.none},this.props.children));}});var SideBarComponent=React.createClass({displayName:"SideBarComponent",getInitialState:function(){this.get_menu_items(); /*
         //TODO: implement get_recent_app_objects using web sockets (server-side and client-side).

         this.get_recent_app_objects();
         var context = this;
         idle_interval = setInterval(function () {
         context.get_recent_app_objects();
         }, 3000);*/return {menu_items:{}};},get_menu_items:function(){var request={};request.entity="app_object";request.method="get_menu_items";var context=this;do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",contentType:"application/json",dataType:'json',data:JSON.stringify(request),success:function(data){console.log(data.data);context.setState({menu_items:data.data});},error:function(error){if(error.responseJSON){console.log(error.responseJSON);context.setState({error:error.responseJSON.message});}},complete:function(){}});},get_recent_app_objects:function(){ //TODO: implement get_recent_app_objects using web sockets.
var request={};request.entity="user";request.method="get_recent_app_objects";var context=this;do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",contentType:"application/json",dataType:'json',data:JSON.stringify(request),success:function(data){context.setState({recent_app_objects:data.data});},error:function(error){if(error.responseJSON){console.log(error.responseJSON);context.setState({error:error.responseJSON.message});}},complete:function(){}});},on_dashboard_click:function(event){event.preventDefault();this.props.navigation_handler("home");},on_invite_users_click:function(event){event.preventDefault();this.props.navigation_handler("invite_users");},on_user_data_list_click:function(event){event.preventDefault();this.props.navigation_handler("user_data_list");},handle_app_object_click:function(app_object,workflow_state,event){if(event&&event.preventDefault){event.preventDefault();}if(workflow_state){if(workflow_state.work_queue_app_object_code){app_object.type="data_list";app_object.code=workflow_state.work_queue_app_object_code;}app_object.workflow_conditions={workflow_status:workflow_state.status_code};console.log(app_object);}else {delete app_object.workflow_conditions;}this.props.app_object_handler(app_object);},componentWillReceiveProps:function(nextProps){if(nextProps.isCompact!=this.props.isCompact){if(!$('#sidebar').is(':visible'))$("#sidebar").toggleClass("hide");if($(".sidebar-menu").closest("div").hasClass("slimScrollDiv")){$(".sidebar-menu").slimScroll({destroy:true});$(".sidebar-menu").attr('style','');}if(nextProps.isCompact){$(".open > .submenu").removeClass("open");}else {if($('.page-sidebar').hasClass('sidebar-fixed')){var position=readCookie("rtl-support")||location.pathname=="/index-rtl-fa.html"||location.pathname=="/index-rtl-ar.html"?'right':'left';$('.sidebar-menu').slimscroll({height:'auto',position:position,size:'3px',color:themeprimary});}}}},handle_search_submit:function(event){event.preventDefault();this.props.search_handler(this.state.search_string);},on_search_string_change:function(event){this.state.search_string=event.target.value;},on_open:function(menuKey,open){if(open){this.setState({openMenyKey:menuKey});}else {this.setState({openMenyKey:undefined});}},render:function(){var menu_items=[];for(var module_key in this.state.menu_items){var module=this.state.menu_items[module_key];var module_name=module.name;var app_objects=[];for(var i=0;i<module.app_objects.length;i++){var app_object=module.app_objects[i];var className="";var workflow_ul="";if(app_object.workflow_states&&app_object.workflow_states.length>0){className="menu-dropdown";var workflows=[];for(var j=0;j<app_object.workflow_states.length;j++){var workflow_state=app_object.workflow_states[j];var workflow_li=React.createElement("li",{key:workflow_state.status_code,onClick:this.handle_app_object_click.bind(this,app_object,workflow_state)},React.createElement("a",{href:""},React.createElement("span",{className:"menu-text"},workflow_state.caption)));workflows.push(workflow_li);}workflow_ul=React.createElement("ul",{className:"submenu1",style:{"display":"block"}},workflows);}var app_object_element=React.createElement("li",{key:app_object.code},React.createElement("a",{href:"",onClick:this.handle_app_object_click.bind(this,app_object,undefined),className:className},React.createElement("span",{className:"menu-text"},app_object.name)),workflow_ul);app_objects.push(app_object_element);}var key=module.code;var isOpen=this.state.openMenyKey==key;var menu_item=React.createElement(SideBarSection,{onOpen:this.on_open.bind(this,key),isCompact:this.props.isCompact,title:module_name,open:isOpen,icon:module.font_awesome_icon,key:key},app_objects);menu_items.push(menu_item);}if(this.state.recent_app_objects&&this.state.recent_app_objects.length>0){var app_objects=[];for(var i=0;i<this.state.recent_app_objects.length;i++){var app_object=React.createElement("li",{key:this.state.recent_app_objects[i].code+this.state.recent_app_objects[i].timestamp},React.createElement("a",{href:"",onClick:this.handle_app_object_click.bind(this,this.state.recent_app_objects[i],null),key:this.state.recent_app_objects[i].code},React.createElement("span",{className:"menu-text"},this.state.recent_app_objects[i].name)));app_objects.push(app_object);}var key="recent_app_objects";var isOpen=this.state.openMenyKey==key;var menu_item=React.createElement(SideBarSection,{onOpen:this.on_open.bind(this,key),isCompact:this.props.isCompact,open:isOpen,title:R.label_recent_app_objects,icon:"fa-file",key:key},app_objects);menu_items.push(menu_item);}var pageSideBarClass="page-sidebar";if(this.props.isCompact==true){pageSideBarClass=pageSideBarClass+" menu-compact";}return React.createElement("div",{className:pageSideBarClass,id:"sidebar"},React.createElement("div",{className:"sidebar-header-wrapper"},React.createElement("form",{onSubmit:this.handle_search_submit},React.createElement("input",{type:"text",className:"searchinput",onChange:this.on_search_string_change})),React.createElement("i",{className:"searchicon fa fa-search"}),React.createElement("div",{className:"searchhelper"},R.label_search_hint)),React.createElement("ul",{className:"nav sidebar-menu"},React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.on_dashboard_click},React.createElement("i",{className:"menu-icon glyphicon glyphicon-home"}),React.createElement("span",{className:"menu-text"}," ",R.label_dashboard," "))),menu_items));}});var UserSettingsComponent=React.createClass({displayName:"UserSettingsComponent",get_secret_questions:function(){var request={};request.entity="secret_question";request.method="read";var context=this;do_authenticated_http_call({method:"GET",url:"/api/auth/get_secret_questions",dataType:"json",data:request,success:function(data){var updated_state={};updated_state.secret_questions=data;if(context.state.data){updated_state.loading=false;}context.setState(updated_state);},error:function(err){},complete:function(){}});},get_user_info:function(){var request={};request.entity="user";request.method="get_info";var context=this;do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",dataType:'json',data:request,success:function(data){ //context.setState({data:data.data, loading:false});
var updated_state={};updated_state.data=data.data;if(context.state.secret_questions){updated_state.loading=false;}context.setState(updated_state);},error:function(error){if(error.responseJSON){context.setState({error:error.responseJSON});}},complete:function(){}});},getInitialState:function(){this.get_user_info();this.get_secret_questions();return {loading:true,update:{},avatar:this.props.avatar};},update_edited_field:function(field_name,value){var update=this.state.update;var data=this.state.data;if(this.state.data[field_name]!=value){update[field_name]=value;data[field_name]=value;}else {if(update[field_name]){update[field_name]=undefined;}}this.setState({update:update,data:data});},on_username_change:function(event){this.update_edited_field("login_name",event.target.value);},on_email_address_change:function(event){this.update_edited_field("email_address",event.target.value);},on_first_name_change:function(event){this.update_edited_field("first_name",event.target.value);},on_last_name_change:function(event){this.update_edited_field("last_name",event.target.value);},on_password_change:function(event){var update=this.state.update;update["password"]=event.target.value;if(update["password"]==""){update["password"]=undefined;}this.setState({update:update});},on_confirm_password_change:function(event){var update=this.state.update;update["confirm_password"]=event.target.value;this.setState({update:update});},on_secret_question_change:function(event){this.update_edited_field("secret_question",event.target.value);},on_secret_answer_change:function(event){this.update_edited_field("secret_answer",event.target.value);},on_language_preference_change:function(event){this.update_edited_field("language_preference",event.target.value);},on_profile_picture_change:function(event){var update=this.state.update;update.avatar=event;this.setState({update:update});},on_error_close:function(){this.setState({error:undefined});},handle_submit:function(event){event.preventDefault();if(Object.keys(this.state.update).length==0){return;}if(this.state.update.confirm_password!=this.state.update.password){this.setState({error:R.message_passwords_dont_match});return;}this.setState({loading:true});var request={};request.entity="user";request.method="update_info";request.data=this.state.update;request.data["confirm_password"]=undefined;var context=this;console.log(JSON.stringify(request));do_authenticated_http_call({method:"POST",url:"/api/entity/invoke_method",contentType:"application/json",dataType:'json',data:JSON.stringify(request),success:function(data){var avatar=context.state.avatar;if(context.state.update.avatar||context.state.update.avatar==null){avatar=context.state.update.avatar;context.props.update_avatar();}context.props.update_user_info();context.setState({update:{},error:undefined,avatar:avatar});Notify(data.message,'bottom-right',20000,'green','fa-check',true);},error:function(error){if(error.responseJSON){console.log(error.responseJSON);context.setState({error:error.responseJSON.message});}},complete:function(){context.setState({loading:false,update:{}});}});},render:function(){if(this.state.loading){return React.createElement("h1",null,"Loading...");}else {var error_component="";if(this.state.error){error_component=React.createElement(ErrorNotificationComponent,{message:this.state.error,on_close:this.on_error_close});}var secret_questions=[];for(var i=0;i<this.state.secret_questions.length;i++){var secret_question=this.state.secret_questions[i];secret_questions.push(React.createElement("option",{key:secret_question.code,value:secret_question.code},secret_question.value));}var avatarEditor=React.createElement(EditorDevExtremeImageUpload,{value:this.state.avatar,readOnly:false,onChange:this.on_profile_picture_change,selectButtonText:R_loc.select_image,resizeWidth:100,resizeHeight:100});return React.createElement("div",{className:"widget"},React.createElement("div",{className:"widget-header bordered-bottom bordered-palegreen"},React.createElement("span",{className:"widget-caption"},R.label_settings)),React.createElement("div",{className:"widget-body"},React.createElement("div",null,error_component,React.createElement("form",{id:"user_settings",className:"form-horizontal form-bordered",role:"form",onSubmit:this.handle_submit},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_username",className:"col-sm-2 control-label no-padding-right"},R.label_username),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"input_username",placeholder:R.label_username,onChange:this.on_username_change,value:this.state.data.login_name}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_email",className:"col-sm-2 control-label no-padding-right"},R.label_email_address),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"email",className:"form-control",id:"input_email",placeholder:R.label_email_address,value:this.state.data.email_address,onChange:this.on_email_address_change}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_first_name",className:"col-sm-2 control-label no-padding-right"},R.label_full_name),React.createElement("div",{className:"col-sm-5"},React.createElement("input",{type:"text",className:"form-control",id:"input_first_name",placeholder:R.label_first_name,value:this.state.data.first_name,onChange:this.on_first_name_change})),React.createElement("div",{className:"col-sm-5"},React.createElement("input",{type:"text",className:"form-control",id:"input_last_name",placeholder:R.label_last_name,value:this.state.data.last_name,onChange:this.on_last_name_change}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_password",className:"col-sm-2 control-label no-padding-right"},R.label_password),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"password",className:"form-control",id:"input_password",placeholder:R.label_password,onChange:this.on_password_change}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_confirm_password",className:"col-sm-2 control-label no-padding-right"},R.label_confirm_password),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"password",className:"form-control",id:"input_confirm_password",placeholder:R.label_confirm_password,onChange:this.on_confirm_password_change}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_secret_question",className:"col-sm-2 control-label no-padding-right"},R.label_secret_question),React.createElement("div",{className:"col-sm-10"},React.createElement("select",{className:"form-control",name:"country",value:this.state.data.secret_question,onChange:this.on_secret_question_change},secret_questions))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_secret_answer",className:"col-sm-2 control-label no-padding-right"},R.label_secret_answer),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"password",className:"form-control",id:"input_secret_answer",placeholder:R.label_secret_answer,onChange:this.on_secret_answer_change}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_secret_question",className:"col-sm-2 control-label no-padding-right"},R.label_language_preference),React.createElement("div",{className:"col-sm-10"},React.createElement("select",{className:"form-control",name:"country",value:this.state.data.language_preference,onChange:this.on_language_preference_change},React.createElement("option",{value:"en-US"},"English"),React.createElement("option",{value:"ru"},"")))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"input_secret_answer",className:"col-sm-2 control-label no-padding-right"},R.label_profile_picture),React.createElement("div",{className:"col-sm-10"},avatarEditor)),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-offset-2 col-sm-10"},React.createElement("button",{type:"submit",className:"btn btn-success shiny"},R.label_save)))))));}}});var EditorDevExtremeCheckBox=React.createClass({displayName:"EditorDevExtremeCheckBox",render:function(){var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;var element=$(this.domElement).dxCheckBox({readOnly:this.props.readOnly,value:this.props.value,text:this.props.text,onValueChanged:function(data){context.props.onChange(data.value);}});}});var EditorDevExtremeDatePicker=React.createClass({displayName:"EditorDevExtremeDatePicker",render:function(){var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;var element=$(this.domElement).dxDateBox({format:"date",readOnly:this.props.readOnly,value:this.props.value,onValueChanged:function(data){context.props.onChange(data.value);}});}});var EditorDevExtremeDateTimePicker=React.createClass({displayName:"EditorDevExtremeDateTimePicker",render:function(){var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;var element=$(this.domElement).dxDateBox({format:"datetime",readOnly:this.props.readOnly,value:this.props.value==null?null:new Date(this.props.value),onValueChanged:function(data){context.props.onChange(data.value);}});}});var EditorFileUploadModel=React.createClass({displayName:"EditorFileUploadModel",getInitialState:function(){return {fileState:'preparing',uploadProgress:0,error:'',downloadUrl:''};},uploadCompleted:function(fileId,file){var context=this;var success=function(event){context.props.onUploadEnd();};var complete=function(event){if(event.status!=200){context.setState({fileState:'none',error:R_loc.cannot_receive_information_from_server});}};invoke_method('file','mark_as_uploaded',{file_id:fileId},success,null,complete);},createFileuploadXHR:function(file,url,fileId){var context=this;this.jqXHR=$.ajaxSettings.xhr();if(this.jqXHR.upload){$(this.jqXHR.upload).bind('progress',function(e){var oe=e.originalEvent;if(oe.lengthComputable){context.setState({uploadProgress:(oe.loaded+context.alreadyLoaded)/(oe.total+context.alreadyLoaded)*100});}});}$(this.jqXHR).bind('abort',function(e){context.setState({fileState:'none'});});$(this.jqXHR).bind('error',function(e){if(context.tries<=5){context.tries++;this.timeout=setTimeout(function(){if(e.target.status==0||e.target.status>=500){context.createRangeRequestXHR(file,url,fileId);if(!context.abort){context.rangeXHR.open("PUT",url,true);context.rangeXHR.setRequestHeader("Content-Range","bytes */"+file.size.toString());context.rangeXHR.send('');}return;}context.setState({fileState:'none',error:R_loc.can_not_upload_file_to_the_server});},5000);}});$(this.jqXHR).bind('load',function(e){if(this.status==200||this.status==201){context.uploadCompleted(fileId,file);return;}context.setState({fileState:'none'});});},createRangeRequestXHR:function(file,url,fileId){var context=this;this.rangeXHR=$.ajaxSettings.xhr();$(this.rangeXHR).bind('load',function(e){if(this.status==308){context.createFileuploadXHR(file,url,fileId);context.jqXHR.open("PUT",url,true);context.jqXHR.setRequestHeader("Content-Type",file.type);var values=e.target.getResponseHeader('range').split('-');var start=parseInt(values[1])+1;context.tries=0;context.alreadyLoaded=start;context.jqXHR.setRequestHeader("Content-Range",'bytes '+start.toString()+'-'+(file.size-1).toString()+'/'+file.size.toString());context.jqXHR.send(file.slice(start));return;}else if(this.status==200||this.status==201){context.uploadCompleted(fileId,file);return;}context.setState({fileState:'none',error:R_loc.can_not_upload_file_to_the_server});});$(this.rangeXHR).bind('abort',function(e){context.setState({fileState:'none'});});$(context.rangeXHR).bind('error',function(e){if(context.tries<=5){context.tries++;this.timeout=setTimeout(function(){if(e.target.status==0||e.target.status>=500){context.createRangeRequestXHR(file,url,fileId);if(!context.abort){context.rangeXHR.open("PUT",url,true);context.rangeXHR.setRequestHeader("Content-Range","bytes */"+file.size.toString());context.rangeXHR.send('');}return;}context.setState({fileState:'none',error:R_loc.can_not_upload_file_to_the_server});},5000);return;}context.setState({fileState:'none',error:R_loc.can_not_upload_file_to_the_server});});},handleCancelClick:function(e){e.preventDefault();this.abort=true;this.jqXHR.abort();if(this.timeout){clearTimeout(this.timeout);}if(this.rangeXHR){this.rangeXHR.abort();}this.props.onUploadCancel();},componentDidMount:function(){$(this.domElement).modal('show');var context=this;this.abort=false;this.setState({fileState:'preparing'});var success=function(event){context.createFileuploadXHR(context.props.file,event.data.url,event.data.file_id);context.jqXHR.open("PUT",event.data.url,true);context.jqXHR.setRequestHeader("Content-Type",context.props.file.type);context.tries=0;context.alreadyLoaded=0;context.setState({uploadProgress:0,error:'',fileState:'uploading'});context.jqXHR.send(context.props.file);};var complete=function(event){if(event.status!=200){context.setState({fileState:'none',error:R_loc.cannot_receive_information_from_server});}};invoke_method('file','get_upload_url',{file_id:this.props.fileId},success,null,complete);},componentWillUnmount:function(){this.abort=true;if(this.jqXHR){this.jqXHR.abort();}if(this.timeout){clearTimeout(this.timeout);}if(this.rangeXHR){this.rangeXHR.abort();}$(this.domElement).modal('hide');},render:function(){var progress='';var cancel='';var preparing='';var close='';if(this.state.fileState=='preparing'){preparing=React.createElement("span",null,R_loc.preparing_for_upload);}if(this.state.fileState=='uploading'){progress=React.createElement("progress",{min:"0",max:"100",value:this.state.uploadProgress,type:"file",style:{"width":"100%"}},this.state.uploadProgress,"% ",R_loc.complete);cancel=React.createElement("div",{className:"text-align-center"},React.createElement("button",{className:"btn btn-default shiny",onClick:this.handleCancelClick},R.label_cancel));}if(this.state.fileState=='none'){close=React.createElement("div",{className:"text-align-center"},React.createElement("button",{className:"btn btn-default shiny",onClick:this.handleCancelClick},R_loc.label_close));}var error='';if(this.state.error!=''){error=React.createElement("div",{className:"alert alert-danger fade in"},React.createElement("button",{className:"close","data-dismiss":"alert"}," "),React.createElement("i",{className:"fa-fw fa fa-times"}),React.createElement("strong",null,R_loc.error,"!"),this.state.error);}var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;},className:"modal fade",tabIndex:"-1",role:"dialog","aria-labelledby":"fileUploadingModalLabel"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h4",{className:"modal-title"},R_loc.file_uploading)),React.createElement("div",{className:"modal-body"},error,progress,cancel,close,preparing))));}});var EditorFileUpload=React.createClass({displayName:"EditorFileUpload",getInitialState:function(){return {downloadUrl:undefined};},componentWillReceiveProps:function(nextProps){if(nextProps.resetFileUpload){this.fileUploadReset();if(nextProps.value){this.getDownloadUrl(this.props.value);}}},render:function(){if(this.props.readOnly){return React.createElement("div",null);}var downloadUrl='';if(this.state.downloadUrl){downloadUrl=React.createElement("a",{href:this.state.downloadUrl,download:true},R_loc.download);}var context=this;return React.createElement("div",{style:{"marginTop":"6px"}},React.createElement("input",{ref:function(ref){context.domElement=ref;},type:"file",style:{"display":"inline"}}),downloadUrl);},componentDidMount:function(){var context=this;if(this.props.readOnly)return;$(this.domElement).on('change',function(e){var file=e.target.files[0];context.props.onFileNameChange(file);});if(this.props.value){this.getDownloadUrl(this.props.value);}if(this.props.fileName){this.setState({fileName:this.props.fileName});}},getDownloadUrl:function(fileId){var context=this;var getFileCompleted=function(data){context.setState({downloadUrl:data.data.url});};invoke_method('file','get_file',{file_id:fileId},getFileCompleted,null);},fileUploadReset:function(){$(this.domElement).wrap('<form>').closest('form').get(0).reset();$(this.domElement).unwrap();}});var EditorHtml=React.createClass({displayName:"EditorHtml",render:function(){var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;context.oldValue=this.props.value;$(this.domElement).html(this.props.value).tinymce({readonly:this.props.readOnly,setup:function(ed){ed.on('NodeChange',function(e){var content=ed.getContent();if(context.oldValue==content)return;context.oldValue=content;context.props.onChange(content);});}});}});var EditorDevExtremeImageUpload=React.createClass({displayName:"EditorDevExtremeImageUpload",getInitialState:function(){return {data:this.props.value,initState:this.props.value};},render:function(){var deleteBtn=null;if(!this.props.readOnly&&this.state.data!=null){deleteBtn=React.createElement("span",{onClick:this.handle_delete,title:R.label_delete,className:"delete-image-span"});}var context=this;return React.createElement("div",null,this.state.data==null||this.state.data==""?null:React.createElement("div",{className:"img-wrap"},deleteBtn,React.createElement("img",{style:{"maxWidth":"100","maxHeight":"100"},src:this.state.data})),React.createElement("div",{className:"editor-image-upload-control",ref:function(ref){context.domElement=ref;}}));},handle_delete:function(e){this.element.reset();e.preventDefault();this.setState({data:null});this.props.onChange(null);},scaleCanvasWithAlgorithm:function(canvas){var scaledCanvas=document.createElement('canvas');var scale=Math.min(this.props.resizeWidth/canvas.width,this.props.resizeHeight/canvas.height);scaledCanvas.width=canvas.width*scale;scaledCanvas.height=canvas.height*scale;var srcImgData=canvas.getContext('2d').getImageData(0,0,canvas.width,canvas.height);var destImgData=scaledCanvas.getContext('2d').createImageData(scaledCanvas.width,scaledCanvas.height);this.applyBilinearInterpolation(srcImgData,destImgData,scale);scaledCanvas.getContext('2d').putImageData(destImgData,0,0);return scaledCanvas;},getHalfScaleCanvas:function(canvas){var halfCanvas=document.createElement('canvas');halfCanvas.width=canvas.width/2;halfCanvas.height=canvas.height/2;halfCanvas.getContext('2d').drawImage(canvas,0,0,halfCanvas.width,halfCanvas.height);return halfCanvas;},applyBilinearInterpolation:function(srcCanvasData,destCanvasData,scale){function inner(f00,f10,f01,f11,x,y){var un_x=1.0-x;var un_y=1.0-y;return f00*un_x*un_y+f10*x*un_y+f01*un_x*y+f11*x*y;}var i,j;var iyv,iy0,iy1,ixv,ix0,ix1;var idxD,idxS00,idxS10,idxS01,idxS11;var dx,dy;var r,g,b,a;for(i=0;i<destCanvasData.height;++i){iyv=i/scale;iy0=Math.floor(iyv); // Math.ceil can go over bounds
iy1=Math.ceil(iyv)>srcCanvasData.height-1?srcCanvasData.height-1:Math.ceil(iyv);for(j=0;j<destCanvasData.width;++j){ixv=j/scale;ix0=Math.floor(ixv); // Math.ceil can go over bounds
ix1=Math.ceil(ixv)>srcCanvasData.width-1?srcCanvasData.width-1:Math.ceil(ixv);idxD=(j+destCanvasData.width*i)*4; // matrix to vector indices
idxS00=(ix0+srcCanvasData.width*iy0)*4;idxS10=(ix1+srcCanvasData.width*iy0)*4;idxS01=(ix0+srcCanvasData.width*iy1)*4;idxS11=(ix1+srcCanvasData.width*iy1)*4; // overall coordinates to unit square
dx=ixv-ix0;dy=iyv-iy0; // I let the r, g, b, a on purpose for debugging
r=inner(srcCanvasData.data[idxS00],srcCanvasData.data[idxS10],srcCanvasData.data[idxS01],srcCanvasData.data[idxS11],dx,dy);destCanvasData.data[idxD]=r;g=inner(srcCanvasData.data[idxS00+1],srcCanvasData.data[idxS10+1],srcCanvasData.data[idxS01+1],srcCanvasData.data[idxS11+1],dx,dy);destCanvasData.data[idxD+1]=g;b=inner(srcCanvasData.data[idxS00+2],srcCanvasData.data[idxS10+2],srcCanvasData.data[idxS01+2],srcCanvasData.data[idxS11+2],dx,dy);destCanvasData.data[idxD+2]=b;a=inner(srcCanvasData.data[idxS00+3],srcCanvasData.data[idxS10+3],srcCanvasData.data[idxS01+3],srcCanvasData.data[idxS11+3],dx,dy);destCanvasData.data[idxD+3]=a;}}},scale_image:function(image){var img=new Image();img.src=image;var canvas=document.createElement('canvas');canvas.width=img.width;canvas.height=img.height;canvas.getContext('2d').drawImage(img,0,0,canvas.width,canvas.height);while(canvas.width>=2*this.props.resizeWidth||canvas.height>=2*this.props.resizeHeight){canvas=this.getHalfScaleCanvas(canvas);}if(canvas.width>this.props.resizeWidth||canvas.height>this.props.resizeHeight){canvas=this.scaleCanvasWithAlgorithm(canvas);}var imageData=canvas.toDataURL('image/jpeg',0.92);return imageData;},componentDidMount:function(){var context=this;if(this.props.readOnly)return;this.element=$(this.domElement).dxFileUploader({accept:"image/*",showFileList:false,selectButtonText:this.props.selectButtonText,uploadMode:'useForm',onValueChanged:function(data){if(data.value!=null){if(!_.isUndefined(FileReader)){var reader=new FileReader();reader.onload=function(e){var image=e.target.result;if(context.props.resizeWidth&&context.props.resizeHeight){image=context.scale_image(e.target.result);}context.setState({data:image});context.props.onChange(image);};reader.readAsDataURL(data.value);}}else {context.setState({data:context.state.initState});context.props.onChange(context.state.initState);}}}).dxFileUploader("instance");}});var EditorDevExtremeMaskedTextBox=React.createClass({displayName:"EditorDevExtremeMaskedTextBox",render:function(){var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;var element=$(this.domElement).dxTextBox(context.props);element.dxTextBox('instance').on("valueChanged",function(data){context.props.onChange(data.value);});}});var EditorDevExtremeMultiLineTextBox=React.createClass({displayName:"EditorDevExtremeMultiLineTextBox",render:function(){var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;var element=$(this.domElement).dxTextArea({height:this.props.height,width:this.props.width,readOnly:this.props.readOnly,value:this.props.value,placeholder:this.props.placeholder,onValueChanged:function(data){context.props.onChange(data.value);}});}});var EditorRecurrenceInput=React.createClass({displayName:"EditorRecurrenceInput",render:function(){var context=this;return React.createElement("textarea",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;$(this.domElement).val(this.props.value);var element=$(this.domElement).recurrenceinput({readOnly:context.props.readOnly});$(this.domElement).on('change',function(e){context.props.onChange($(e.target).val());});}});var EditorDevExtremeSelectBox=React.createClass({displayName:"EditorDevExtremeSelectBox",render:function(){var context=this;var className="";if(this.props.add_button){className="add-button-margin";}return React.createElement("div",{className:className,ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;$(this.domElement).dxSelectBox({readOnly:context.props.readOnly,value:context.props.value,displayExpr:context.props.displayExpr,valueExpr:context.props.valueExpr,dataSource:context.props.dataSource,searchEnabled:true,onValueChanged:function(data){context.props.onChange(data.value);}});}});var EditorDevExtremeTagBox=React.createClass({displayName:"EditorDevExtremeTagBox",getInitialState:function(){return {};},render:function(){var context=this;var className="";if(this.props.add_button){className="add-button-margin";}return React.createElement("div",{className:className,ref:function(ref){context.domElement=ref;}});},componentWillReceiveProps:function(nextProps){if(nextProps.values){this.state.tagbox_element._valuesData=this.parseValues(nextProps.values);this.state.tagbox_element.repaint();}},parseValues:function(inputValues){var values=[];for(var i=0;i<inputValues.length;i++){var item=inputValues[i];if(typeof item=="object"){values.push(item[this.props.valueExpr]);}else {values.push(item);}}return inputValues;},componentDidMount:function(){var context=this;var tagbox_element=$(this.domElement);var values=this.parseValues(context.props.values);this.state.tagbox_element=tagbox_element.dxTagBox({readOnly:context.props.readOnly,values:values,displayExpr:context.props.displayExpr,valueExpr:context.props.valueExpr,dataSource:context.props.dataSource,searchEnabled:true,onValueChanged:function(data){context.props.onChange(data.values);}}).dxTagBox("instance"); // Handle adding item on enter
this.state.tagbox_element.registerKeyHandler("enter",function(e){e.preventDefault();if(this.option("fieldEditEnabled")&&!this._$list.find(".dx-state-focused").length){this._completeSelection();}else {if(this.option("opened")){this._selectFirstItem();this._completeSelection();}else {this.option("opened")&&e.preventDefault();this._keyboardProcessor._childProcessors[0].process(e);}}});}});var EditorDevExtremeTimePicker=React.createClass({displayName:"EditorDevExtremeTimePicker",render:function(){var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;var element=$(this.domElement).dxDateBox({format:"time",readOnly:this.props.readOnly,value:this.props.value==null?null:new Date(this.props.value),onValueChanged:function(data){context.props.onChange(data.value);}});}});var EditorDevExtremeSwitchYesNo=React.createClass({displayName:"EditorDevExtremeSwitchYesNo",render:function(){var context=this;return React.createElement("div",{ref:function(ref){context.domElement=ref;}});},componentDidMount:function(){var context=this;var element=$(this.domElement).dxSwitch({readOnly:this.props.readOnly,value:this.props.value,onText:R.label_yes,offText:R.label_no,onValueChanged:function(data){context.props.onChange(data.value);}});}});
//# sourceMappingURL=app.min.js.map
